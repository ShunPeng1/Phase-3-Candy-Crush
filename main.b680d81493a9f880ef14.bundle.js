(()=>{"use strict";var e,t={116:(e,t,i)=>{var s=i(440);class l extends Phaser.Scene{constructor(){super({key:"BootScene"})}preload(){this.cameras.main.setBackgroundColor(10016391),this.createLoadingbar(),this.load.on("progress",(e=>{this.progressBar.clear(),this.progressBar.fillStyle(16774867,1),this.progressBar.fillRect(this.cameras.main.width/4,this.cameras.main.height/2-16,this.cameras.main.width/2*e,16)}),this),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy()}),this),this.load.pack("preload","./assets/pack.json","preload"),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy(),this.scene.start("GameScene")}),this)}create(){this.createAnimations()}createLoadingbar(){this.loadingBar=this.add.graphics(),this.loadingBar.fillStyle(6139463,1),this.loadingBar.fillRect(this.cameras.main.width/4-2,this.cameras.main.height/2-18,this.cameras.main.width/2+4,20),this.progressBar=this.add.graphics()}createAnimations(){let e=[];for(let t=5;t<=17;t++)e.push({key:`boom-${t.toString().padStart(2,"0")}`});this.anims.create({key:"bomb-animation",frames:e,frameRate:15})}}const r=l,n=["red","yellow","green","purple"],o={score:0,highscore:0,gridWidth:8,gridHeight:8,tileWidth:72,tileHeight:72,candyColors:["red","yellow","green","purple","blue","orange"],normalCandyTextureKey:{red:"item-01",yellow:"item-02",green:"item-03",purple:"item-04",blue:"item-05",orange:"item-06"},verticalStripesCandyTextureKey:{red:"item-01-stripes-vert",yellow:"item-02-stripes-vert",green:"item-03-stripes-vert",purple:"item-04-stripes-vert",blue:"item-05-stripes-vert",orange:"item-06-stripes-vert"},horizontalStripesCandyTextureKey:{red:"item-01-stripes-horiz",yellow:"item-02-stripes-horiz",green:"item-03-stripes-horiz",purple:"item-04-stripes-horiz",blue:"item-05-stripes-horiz",orange:"item-06-stripes-horiz"},bombCandyTextureKey:{red:"bomb-items-01",yellow:"bomb-items-02",green:"bomb-items-03",purple:"bomb-items-04",blue:"bomb-items-05",orange:"bomb-items-06"},bearCandyTextureKey:{red:"item-mar-01",yellow:"item-mar-02",green:"item-mar-03",purple:"item-mar-04",blue:"item-mar-05",orange:"item-mar-06"},cholateCandyTextureKey:"game-item-h",itemSpot1TextureKey:"item-spot",itemSpot2TextureKey:"item-spot-2"},h=class{static applyImageScaleTweens(e,t,i,s=.95,l=100){let r,n=!1,o=null,h=null;const a=()=>{h&&h.complete(),r=new Phaser.Math.Vector2(e.scaleX,e.scaleY);const t=r.x*s,i=r.y*s;n=!0,o=e.scene.tweens.add({targets:e,scaleX:t,scaleY:i,duration:l,ease:"Linear",onComplete:()=>{e.setScale(t,i),o=null}})},d=()=>{n&&(o&&o.stop(),n=!1,h=e.scene.tweens.add({targets:e,scaleX:r.x,scaleY:r.y,duration:l,ease:"Linear",onComplete:()=>{e.setScale(r.x,r.y),h=null}}))};"string"==typeof t&&(t=[t]),t.forEach((t=>{e.on(t,a)})),"string"==typeof i&&(i=[i]),i.forEach((t=>{e.on(t,d)}))}static applyImageDisplaySizeTweens(e,t,i,s=.95,l=100){let r,n=!1,o=null,h=null;const a=()=>{h&&h.complete(),console.log("Set to new scale"),r=new Phaser.Math.Vector2(e.displayWidth,e.displayHeight);const t=r.x*s,i=r.y*s;n=!0,o=e.scene.tweens.add({targets:e,displayWidth:t,displayHeight:i,duration:l,ease:"Linear",onComplete:()=>{e.setDisplaySize(t,i),o=null}})},d=()=>{n&&(o&&o.stop(),n=!1,h=e.scene.tweens.add({targets:e,displayWidth:r.x,displayHeight:r.y,duration:l,ease:"Linear",onComplete:()=>{e.setDisplaySize(r.x,r.y),h=null}}))};"string"==typeof t&&(t=[t]),t.forEach((t=>{e.on(t,a)})),"string"==typeof i&&(i=[i]),i.forEach((t=>{e.on(t,d)}))}};class a extends Phaser.GameObjects.Image{constructor(e){super(e.scene,e.x,e.y,e.texture,e.frame),this.mapTween=new Map,this.isPointerOver=!1,this.isDestroyed=!1,this.isPop=!1,this.setOrigin(.5,.5),this.enableTileInteraction(),this.scene.add.existing(this)}disableTileInteraction(){this.isDestroyed||(this.disableInteractive(),this.isPointerOver&&this.emit("pointerout"),this.off("pointerover"),this.off("pointerout"))}enableTileInteraction(){this.isDestroyed||(this.setInteractive(),this.on("pointerover",this.onPointerOver,this),this.on("pointerout",this.onPointerOut,this),h.applyImageDisplaySizeTweens(this,"pointerover","pointerout",1.1,100))}addMapTween(e,t){this.mapTween.set(e,t)}getMapTween(e){return this.mapTween.get(e)}removeMapTween(e){this.mapTween.delete(e)}onPointerOver(){this.isPointerOver=!0}onPointerOut(){this.isPointerOver=!1}setTileEffect(e){return this.tileEffect=e,this.tileEffect.onTileAppear(),this}setTileGrid(e){return this.grid=e,this}getWorldPosition(){const e=this.grid.getWorldTransformMatrix();let t=this.getLocalTransformMatrix();return t.tx+=e.tx,t.ty+=e.ty,t}getTileGrid(){return this.grid}getColor(){return this.tileEffect.color}pop(){this.isPop||(this.isPop=!0,this.tileEffect.onTilePop())}destroy(e){this.isDestroyed||(this.isDestroyed=!0,this.tileEffect.onTileDestroy(),super.destroy(e))}}const d=a;class c extends Phaser.Events.EventEmitter{constructor(e,t){super(),this.scene=e,this.tileSwapper=t,this.selectingTile=null,this.scene.anims.create({key:"indicator-animation",frames:[{key:"indicator-0"},{key:"indicator-1"},{key:"indicator-2"},{key:"indicator-3"}],frameRate:10,repeat:-1}),this.indicator=this.scene.add.sprite(0,0,"indicator-0"),this.indicator.setVisible(!1),this.indicator.setScale(2.3),this.indicator.play("indicator-animation"),this.registerInputEvents(e)}registerInputEvents(e){e.input.on("gameobjectdown",((e,t,i)=>{if(!0===this.tileSwapper.getCanMove()){if(this.tileSwapper.selectTile(t),this.tileSwapper.checkIsSwapped())this.selectingTile=null,this.indicator.setVisible(!1);else{this.selectingTile=t,this.indicator.setVisible(!0);let i=this.selectingTile.getWorldTransformMatrix();this.indicator.setPosition(i.tx,i.ty),this.downPosition=new Phaser.Math.Vector2(e.x,e.y)}this.tileSwapper.checkFirstTileSelected()||(this.selectingTile=null,this.indicator.setVisible(!1))}})),e.input.on("gameobjectup",((e,t,i)=>{this.tileSwapper.getCanMove()&&this.selectingTile&&this.selectingTile!==t&&(this.tileSwapper.selectTile(t),this.selectingTile=null,this.indicator.setVisible(!1))})),e.input.on("pointerover",((e,t)=>{t.forEach((e=>{e instanceof d&&this.tileSwapper.getCanMove()&&this.selectingTile&&this.selectingTile!==e&&(this.tileSwapper.selectTile(e),this.selectingTile=null,this.indicator.setVisible(!1))}))}))}}const p=c;class u extends s.GameObjects.Container{constructor(e,t,i,s,l,r,n,o,h=[]){super(e,t,i),this.scene=e,this.gridWidth=s,this.gridHeight=l,this.tileWidth=r,this.tileHeight=n,this.tileFactory=o,this.gridTextures=h,this.scene.add.existing(this),this.initializeGrid()}initializeGrid(){if(0!=this.gridTextures.length)if(1===this.gridTextures.length)for(let e=0;e<this.gridHeight;e++)for(let t=0;t<this.gridWidth;t++){let i=this.scene.add.image(t*this.tileWidth,e*this.tileHeight,this.gridTextures[0]);i.setDisplaySize(this.tileWidth,this.tileHeight),i.setOrigin(0,0),this.add(i),this.sendToBack(i)}else if(2===this.gridTextures.length)for(let e=0;e<this.gridHeight;e++)for(let t=0;t<this.gridWidth;t++){let i=this.scene.add.image(t*this.tileWidth,e*this.tileHeight,this.gridTextures[(t+e)%2]);i.setDisplaySize(this.tileWidth,this.tileHeight),i.setOrigin(0,0),this.add(i),this.sendToBack(i)}}initializeTiles(){this.tileGrid=[];for(let e=0;e<this.gridHeight;e++){this.tileGrid[e]=[];for(let t=0;t<this.gridWidth;t++){let i=this.createRandomTile(t,e-this.gridHeight);this.tileGrid[e][t]=i,this.emit(u.TILE_ADD_EVENT,i,t,e-this.gridHeight,t,e)}}this.popedTilesGrid=[];for(let e=0;e<this.gridHeight;e++){this.popedTilesGrid[e]=[];for(let t=0;t<this.gridWidth;t++)this.popedTilesGrid[e][t]=null}this.emit(u.TILE_CHANGE_EVENT)}getTileIndex(e,t=!1){let i=null;for(let t=0;t<this.tileGrid.length;t++)for(let s=0;s<this.tileGrid[t].length;s++)if(e===this.tileGrid[t][s])return i=new Phaser.Math.Vector2(s,t),i;if(t)for(let t=0;t<this.popedTilesGrid.length;t++)for(let s=0;s<this.popedTilesGrid[t].length;s++)if(e===this.popedTilesGrid[t][s])return i=new Phaser.Math.Vector2(s,t),i;return i}getTileIndexInPopedGrid(e){let t=null;for(let i=0;i<this.popedTilesGrid.length;i++)for(let s=0;s<this.popedTilesGrid[i].length;s++)if(e===this.popedTilesGrid[i][s])return t=new Phaser.Math.Vector2(s,i),t;return t}gravitateTile(){for(let e=this.tileGrid.length-1;e>=0;e--)for(let t=this.tileGrid[e].length-1;t>=0;t--){if(null!==this.tileGrid[e][t])continue;let i=null,s=e-1;for(let l=e-1;l>=0&&null===i;l--)i=this.tileGrid[l][t],s=l;null!==i&&(this.tileGrid[e][t]=i,this.tileGrid[s][t]=null,this.emit(u.TILE_GRAVITATE_EVENT,i,t,s,t,e))}}fillEmptyGridWithTile(){for(var e=0;e<this.tileGrid.length;e++)for(var t=0;t<this.tileGrid[e].length;t++){if(null!==this.tileGrid[e][t])continue;let i=this.tileGrid.length;for(let s=e+1;s<this.tileGrid.length;s++)if(null!==this.tileGrid[s][t]){i=s;break}let s=this.createRandomTile(t,e-i);this.tileGrid[e][t]=s,this.emit(u.TILE_ADD_EVENT,s,t,e-i,t,e)}this.emit(u.TILE_CHANGE_EVENT)}destroyAllPopTiles(){for(let e=0;e<this.popedTilesGrid.length;e++)for(let t=0;t<this.popedTilesGrid[e].length;t++){const i=this.popedTilesGrid[e][t];null!==i&&(this.remove(i),i.destroy(),this.popedTilesGrid[e][t]=null)}}destroyPopTile(e){let t=this.getTileIndexInPopedGrid(e);null!==t&&(this.remove(e),this.popedTilesGrid[t.y][t.x]=null,e.destroy())}destroyPopTiles(e){for(var t=0;t<e.length;t++)this.destroyPopTile(e[t])}popTiles(e){for(var t=0;t<e.length;t++)this.popTile(e[t])}popTile(e){let t=this.getTileIndex(e);t&&(this.popedTilesGrid[t.y][t.x]=e,this.tileGrid[t.y][t.x]=null,e.pop())}addTileAtIndex(e,t,i){e.setTileGrid(this),this.add(e),e.setPosition((t+.5)*this.tileWidth,(i+.5)*this.tileHeight),this.tileGrid[i][t]=e}addTileAtWorldPosition(e,t,i){let s=Math.floor((t-this.x)/this.tileWidth),l=Math.floor((i-this.y)/this.tileHeight);l>=0&&l<this.tileGrid.length&&s>=0&&s<this.tileGrid[l].length&&this.addTileAtIndex(e,s,l)}addTileAtLocalPosition(e,t,i){let s=Math.floor((t+.5)/this.tileWidth),l=Math.floor((i+.5)/this.tileHeight);l>=0&&l<this.tileGrid.length&&s>=0&&s<this.tileGrid[l].length&&this.addTileAtIndex(e,s,l)}swapTiles(e,t){if(!e||!t)return;let i=e.x,s=e.y,l=t.x,r=t.y;this.tileGrid[s/this.tileHeight-.5][i/this.tileWidth-.5]=t,this.tileGrid[r/this.tileHeight-.5][l/this.tileWidth-.5]=e,this.emit(u.TILE_SWAP_EVENT,e,t),this.emit(u.TILE_CHANGE_EVENT)}getTileGrid(){return this.tileGrid}getFlattenTileGrid(){let e=[];for(let t=0;t<this.tileGrid.length;t++)for(let i=0;i<this.tileGrid[t].length;i++)null!==this.tileGrid[t][i]&&e.push(this.tileGrid[t][i]);return e}getPopedTileGrid(){return this.popedTilesGrid}getDistance(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}getMahattanDistance(e,t){return new Phaser.Math.Vector2(Math.abs(e.x-t.x),Math.abs(e.y-t.y))}getMahattanIndexDistance(e,t){return new Phaser.Math.Vector2(Math.abs(e.x-t.x)/this.tileWidth,Math.abs(e.y-t.y)/this.tileHeight)}getRow(e){return this.tileGrid[e]}getColumn(e){let t=[];for(let i=0;i<this.tileGrid.length;i++)t.push(this.tileGrid[i][e]);return t}getTileAtIndex(e,t){return t<0||t>=this.tileGrid.length||e<0||e>=this.tileGrid[t].length?null:this.tileGrid[t][e]}getTileAtWorldPosition(e,t){let i=null,s=Math.floor((e-this.x)/this.tileWidth),l=Math.floor((t-this.y)/this.tileHeight);return l>=0&&l<this.tileGrid.length&&s>=0&&s<this.tileGrid[l].length&&(i=this.tileGrid[l][s]),i}getWorldPositionFromIndex(e,t){return new Phaser.Math.Vector2(e*this.tileWidth+this.x,t*this.tileHeight+this.y)}getLocalPositionFromIndex(e,t){return new Phaser.Math.Vector2((e+.5)*this.tileWidth,(t+.5)*this.tileHeight)}getRowCount(){return this.gridHeight}getColumnCount(){return this.gridWidth}createRandomTile(e,t){let i=this.tileFactory.createRandomTile((e+.5)*this.tileWidth,(t+.5)*this.tileHeight);return i.setTileGrid(this),this.add(i),i}}u.TILE_CHANGE_EVENT="tileChange",u.TILE_SWAP_EVENT="tileSwap",u.TILE_ADD_EVENT="tileAdd",u.TILE_GRAVITATE_EVENT="tileGravitate";const g=u,T=class{constructor(e,t,i,s){this.count=e,this.matchTiles=t,this.originTile=i,this.specialTileType=s,this.matchTilesExceptOrigin=this.matchTiles.filter((e=>e!==this.originTile))}},m=class{constructor(e){this.tileGrid=e}getMatches(){this.visitedTiles=new Set;let e=this.findVerticalMatches(),t=this.findHorizontalMatches(),i=this.findSquareMatches(),s=[];return this.extract5OrMoreContinuousMatch(e,s,t),this.extractCornerMatch(e,t,s),this.extract4ContinuousMatch(e,s,t),this.extractSquareMatch(i,s),this.extract3ContinuousMatch(e,s,t),s}extract5OrMoreContinuousMatch(e,t,i){this.sliceAllNonVisitedTileInMatch(e);for(let i=e.length-1;i>=0;i--){if(e[i].length<5)continue;let s=e[i],l=s[0],r=s.length;t.push(new T(r,s,l,"COLOR_CLEAR")),this.addToVisitedTiles(s),e.splice(i,1),this.sliceAllNonVisitedTileInMatch(e),i=e.length}this.sliceAllNonVisitedTileInMatch(i);for(let e=i.length-1;e>=0;e--){if(i[e].length<5)continue;let s=i[e],l=s[0],r=s.length;t.push(new T(r,s,l,"COLOR_CLEAR")),this.addToVisitedTiles(s),i.splice(e,1),this.sliceAllNonVisitedTileInMatch(i),e=i.length}}extractCornerMatch(e,t,i){this.sliceAllNonVisitedTileInMatch(e),this.sliceAllNonVisitedTileInMatch(t);for(let s=e.length-1;s>=0;s--)for(let l=t.length-1;l>=0&&!(s<0);l--){let r=e[s],n=t[l],o=this.intersection2TilesArray(r,n);if(0==o.length)continue;let h=this.union2TilesArray(r,n),a=o[0],d=h.length;i.push(new T(d,h,a,"BOMB")),this.addToVisitedTiles(h),t.splice(l,1),e.splice(s,1),this.sliceAllNonVisitedTileInMatch(e),this.sliceAllNonVisitedTileInMatch(t),s=e.length-1,l=t.length}}extract3ContinuousMatch(e,t,i){this.sliceAllNonVisitedTileInMatch(e);for(let i=e.length-1;i>=0;i--){if(3!=e[i].length)continue;let s=e[i],l=s[0],r=s.length;t.push(new T(r,s,l,"NONE")),this.addToVisitedTiles(s),e.splice(i,1),this.sliceAllNonVisitedTileInMatch(e),i=e.length}this.sliceAllNonVisitedTileInMatch(i);for(let e=i.length-1;e>=0;e--){if(3!=i[e].length)continue;let s=i[e],l=s[0],r=s.length;t.push(new T(r,s,l,"NONE")),this.addToVisitedTiles(s),i.splice(e,1),this.sliceAllNonVisitedTileInMatch(i),e=i.length}}extract4ContinuousMatch(e,t,i){this.sliceAllNonVisitedTileInMatch(e);for(let i=e.length-1;i>=0;i--){if(4!=e[i].length)continue;let s=e[i],l=s[0],r=s.length;t.push(new T(r,s,l,"ROW_CLEAR")),this.addToVisitedTiles(s),e.splice(i,1),this.sliceAllNonVisitedTileInMatch(e),i=e.length}this.sliceAllNonVisitedTileInMatch(i);for(let e=i.length-1;e>=0;e--){if(4!=i[e].length)continue;let s=i[e],l=s[0],r=s.length;t.push(new T(r,s,l,"COLUMN_CLEAR")),this.addToVisitedTiles(s),i.splice(e,1),this.sliceAllNonVisitedTileInMatch(i),e=i.length}}extractSquareMatch(e,t){this.sliceAllNonVisitedTileInMatch(e);for(let i=e.length-1;i>=0;i--){if(4!=e[i].length)continue;let s=e[i],l=s[0],r=s.length;t.push(new T(r,s,l,"RANDOM_2")),this.addToVisitedTiles(s),e.splice(i,1),this.sliceAllNonVisitedTileInMatch(e),i=e.length}}addToVisitedTiles(e){for(let t of e)this.visitedTiles.add(t)}sliceAllNonVisitedTileInMatch(e){for(let t=e.length-1;t>=0;t--){let i=e[t];for(let s=i.length-1;s>=0;s--)if(this.visitedTiles.has(i[s])){let l=i.slice(0,s),r=i.slice(s+1,i.length);e.splice(t,1),l.length>=3&&(e.push(l),t=e.length),r.length>=3&&(e.push(r),t=e.length);break}}}union2TilesArray(e,t){return[...new Set([...e,...t])]}union3TilesArray(e,t,i){return[...new Set([...e,...t,...i])]}intersection2TilesArray(e,t){return e.filter((e=>t.includes(e)))}intersection3TilesArray(e,t,i){return e.filter((e=>t.includes(e)&&i.includes(e)))}findHorizontalMatches(){let e=[],t=[];for(let i=0;i<this.tileGrid.getRowCount();i++){let s=this.tileGrid.getRow(i);t=[];for(let l=0;l<s.length-2;l++){let s=this.tileGrid.getTileAtIndex(l,i),r=this.tileGrid.getTileAtIndex(l+1,i),n=this.tileGrid.getTileAtIndex(l+2,i);s&&r&&n&&s.getColor()===r.getColor()&&r.getColor()===n.getColor()&&(t.length>0&&-1==t.indexOf(s)&&(e.push(t),t=[]),-1==t.indexOf(s)&&t.push(s),-1==t.indexOf(r)&&t.push(r),-1==t.indexOf(n)&&t.push(n))}t.length>0&&e.push(t)}return e}findVerticalMatches(){let e=[];for(let t=0;t<this.tileGrid.getColumnCount();t++){let i=[];for(let s=0;s<this.tileGrid.getRowCount()-2;s++){let l=this.tileGrid.getTileAtIndex(t,s),r=this.tileGrid.getTileAtIndex(t,s+1),n=this.tileGrid.getTileAtIndex(t,s+2);l&&r&&n&&l.getColor()===r.getColor()&&r.getColor()===n.getColor()&&(i.length>0&&-1==i.indexOf(l)&&(e.push(i),i=[]),-1==i.indexOf(l)&&i.push(l),-1==i.indexOf(r)&&i.push(r),-1==i.indexOf(n)&&i.push(n))}i.length>0&&e.push(i)}return e}findSquareMatches(){let e=[];for(let t=0;t<this.tileGrid.getRowCount()-1;t++)for(let i=0;i<this.tileGrid.getColumnCount()-1;i++){let s=this.tileGrid.getTileAtIndex(i,t),l=this.tileGrid.getTileAtIndex(i+1,t),r=this.tileGrid.getTileAtIndex(i,t+1),n=this.tileGrid.getTileAtIndex(i+1,t+1);s&&l&&r&&n&&s.getColor()===l.getColor()&&s.getColor()===r.getColor()&&s.getColor()===n.getColor()&&e.push([s,l,r,n])}return e}},y=class{constructor(e,t){this.scene=e,this.firstSelectedTile=null,this.secondSelectedTile=null,this.canMove=!0,this.isSwapped=!1,this.tileGrid=t}swapTiles(){if(this.firstSelectedTile&&this.secondSelectedTile){this.isSwapped=!0,this.tileGrid.swapTiles(this.firstSelectedTile,this.secondSelectedTile);const e=this.firstSelectedTile;this.firstSelectedTile=this.secondSelectedTile,this.secondSelectedTile=e}}unswapTiles(){if(this.firstSelectedTile&&this.secondSelectedTile){this.isSwapped=!1,this.tileGrid.swapTiles(this.firstSelectedTile,this.secondSelectedTile);const e=this.firstSelectedTile;this.firstSelectedTile=this.secondSelectedTile,this.secondSelectedTile=e}}selectTile(e){if(!this.canMove)return;if(!this.firstSelectedTile)return void(this.firstSelectedTile=e);if(this.firstSelectedTile===e)return void this.resetSelectedTile();this.secondSelectedTile=e;let t=0,i=0;if(this.firstSelectedTile&&this.secondSelectedTile){let e=this.tileGrid.getMahattanIndexDistance(this.firstSelectedTile,this.secondSelectedTile);t=e.x,i=e.y}1===t&&0===i||0===t&&1===i?(this.canMove=!1,this.swapTiles()):(this.firstSelectedTile=e,this.secondSelectedTile=null)}resetSelectedTile(){this.firstSelectedTile=null,this.secondSelectedTile=null,this.isSwapped=!1}setCanMove(e){this.canMove=e}checkIsSwapped(){return this.isSwapped}checkFirstTileSelected(){return null!==this.firstSelectedTile}getCanMove(){return this.canMove}},f=class{constructor(e,t,i,s){this.scene=e,this.tile=t,this.color=i,this.texture=s}onTileAppear(){const e=this.tile.scaleX,t=this.tile.scaleY;this.scene.add.tween({targets:this.tile,scaleX:{from:0,to:e},scaleY:{from:0,to:t},duration:500,ease:"Back.out"})}onTilePop(){}onTileDestroy(){}onTileSwap(e){}},x=class{constructor(e){this.isComplete=!1,this.tween=e,this.tween.on("complete",(()=>{this.isComplete=!0})),this.tween.pause(),this.isComplete=!1}update(){}start(){this.tween.play()}stop(){this.tween.stop()}getCompleted(){return this.isComplete}},w=class extends f{constructor(e,t,i,s){super(e,t,i,s)}onTilePop(){let e=this.tile.getTileGrid();this.tileGrid=e;let t=e.getFlattenTileGrid(),i=t[Math.floor(Math.random()*t.length)],s=t[Math.floor(Math.random()*t.length)];if(!(t.length<2)){for(;i===this.tile||s===this.tile||i===s;)i=t[Math.floor(Math.random()*t.length)],s=t[Math.floor(Math.random()*t.length)];this.tileToDestroy1=i,this.tileToDestroy2=s,e.popTiles([i,s])}}onTileDestroy(){let e=this.scene.data.get("simulationController"),t=this.tile.getWorldPosition(),i=this.scene.add.particles(t.tx,t.ty,this.texture,{radial:!0,angle:{min:0,max:360},speed:{min:500,max:1e3},quantity:15,lifespan:500,alpha:{start:1,end:0},scale:{min:.5,max:1},rotate:{min:0,max:360}});i.setScale(.15),i.explode(25),this.scene.time.delayedCall(2e3,(()=>{i.destroy()}));let s=this.createExplosionAnimation(this.tileToDestroy1),l=this.createExplosionAnimation(this.tileToDestroy2);e.addSimulation(new x(s),!0),e.addSimulation(new x(l),!0)}createExplosionAnimation(e){let t=this.tile.getWorldPosition(),i=e.getWorldPosition(),s=this.scene.add.image(t.tx,t.ty,this.texture),l=this.scene.add.image(i.tx,i.ty,"bomb-selection-01");return l.setVisible(!1),l.setPosition(i.tx,i.ty),this.scene.tweens.chain({tweens:[{targets:s,scale:{from:.25,to:1},x:{from:t.tx,to:(i.tx+t.tx)/2},y:{from:t.ty,to:(i.ty+t.ty)/2},duration:300,ease:"Quart.easeOut"},{targets:s,scale:{from:1,to:.25},x:{from:(i.tx+t.tx)/2,to:i.tx},y:{from:(i.ty+t.ty)/2,to:i.ty},duration:300,ease:"Sine.easeIn",onComplete:()=>{s.destroy()}},{targets:l,scale:{from:.25,to:1},alpha:{from:.5,to:2},duration:300,ease:"Linear",onStart:()=>{l.setVisible(!0)},onComplete:()=>{l.setVisible(!1),l.destroy(),this.tileGrid.destroyPopTile(e)}}]})}},S=class extends f{constructor(e,t,i,s){super(e,t,i,s),this.tilesToDestroy=[]}onTilePop(){let e=this.tile.getTileGrid(),t=e.getTileIndex(this.tile,!0);this.tileIndex=t;for(let i=-1;i<=1;i++)for(let s=-1;s<=1;s++){let l=e.getTileAtIndex(t.x+i,t.y+s);null!=l&&l!=this.tile&&this.tilesToDestroy.push(l)}e.popTiles(this.tilesToDestroy)}onTileDestroy(){let e=this.scene.data.get("simulationController"),t=this.tile.getWorldPosition(),i=this.scene.add.sprite(t.tx,t.ty,"bomb-05");i.play("bomb-animation");let s=this.scene.tweens.chain({tweens:[{targets:i,scale:{from:0,to:1.5},alpha:{from:0,to:.8},duration:500,ease:"Cubic.easeOut"},{targets:i,alpha:{from:.8,to:0},duration:300,ease:"Cubic.easeIn"}],onComplete:()=>{i.destroy()}});this.tilesToDestroy.forEach((e=>{e.destroy()})),e.addSimulation(new x(s),!0)}},C=class{constructor(e){this.isComplete=!1,this.tween=e,this.tween.on("complete",(()=>{this.isComplete=!0})),this.tween.pause(),this.isComplete=!1}update(){}start(){this.tween.play()}stop(){this.tween.stop()}getCompleted(){return this.isComplete}},G=class extends f{constructor(e,t,i,s){super(e,t,i,s),this.popTilesRight=[],this.popTilesLeft=[]}onTilePop(){let e=this.tile.getTileGrid(),t=e.getTileIndex(this.tile,!0);this.tileIndex=t;for(let i=t.x+1;i<e.getRowCount();i++){let s=e.getTileAtIndex(i,t.y);null!=s&&s!=this.tile&&this.popTilesLeft.push(s)}for(let i=t.x-1;i>=0;i--){let s=e.getTileAtIndex(i,t.y);null!=s&&s!=this.tile&&this.popTilesRight.push(s)}e.popTiles(this.popTilesRight),e.popTiles(this.popTilesLeft)}onTileDestroy(){let e=this.scene.data.get("simulationController"),t=this.tile.getWorldPosition(),i=this.tile.getTileGrid(),s=this.scene.add.image(t.tx,t.ty,"stripes_destroy");s.setOrigin(1,.5);let l=new Set;const r=e=>{const t=e.getValue(),s=e.targets;l.has(Math.floor(t))||i.destroyPopTile(s[Math.floor(t)])};let n=this.scene.tweens.chain({tweens:[{targets:s,x:{from:t.tx,to:t.tx+500},scaleY:{from:.8,to:1.2},scaleX:{from:1,to:4},duration:250,ease:"Cubic.in"},{targets:s,x:{from:t.tx+500,to:t.tx+1e3},duration:250,ease:"Cubic.out"}]}),o=this.scene.add.image(t.tx,t.ty,"stripes_destroy");o.setOrigin(0,.5);let h=this.scene.tweens.chain({tweens:[{targets:o,x:{from:t.tx,to:t.tx-500},scaleY:{from:.8,to:1.2},scaleX:{from:1,to:4},duration:250,ease:"Cubic.in"},{targets:o,x:{from:t.tx-500,to:t.tx-1e3},duration:250,ease:"Cubic.out"}]}),a=this.scene.add.tween({targets:this.popTilesRight,values:{from:0,to:this.popTilesRight.length-1},duration:400,ease:"Cubic.easeInOut",onUpdate:r}),d=this.scene.add.tween({targets:this.popTilesLeft,values:{from:0,to:this.popTilesLeft.length-1},duration:400,ease:"Cubic.easeInOut",onUpdate:r});e.addSimulation(new x(n),!0),e.addSimulation(new x(h),!0),e.addSimulation(new C(a),!0),e.addSimulation(new C(d),!0),this.scene.time.delayedCall(500,(()=>{s.destroy(),o.destroy()}))}},M=class{constructor(e,t,i,s=0){this.isComplete=!1,this.timerEvent=e.time.addEvent({delay:t,callback:i,callbackScope:this,repeat:s,loop:!1,paused:!0})}update(){}start(){this.timerEvent.paused=!1}stop(){this.timerEvent.paused=!0,this.timerEvent.remove(!1),this.isComplete=!0}getCompleted(){return this.isComplete||0==this.timerEvent.getOverallRemainingSeconds()}},E=class extends f{constructor(e,t,i,s){super(e,t,i,s)}onTilePop(){this.tile.getTileGrid()}onTileDestroy(){let e=this.scene.data.get("simulationController"),t=this.tile.getWorldPosition(),i=this.scene.add.particles(t.tx,t.ty,this.texture,{radial:!0,angle:{min:0,max:360},speed:{min:500,max:1e3},quantity:15,lifespan:500,alpha:{start:1,end:0},scale:{min:.5,max:1},rotate:{min:0,max:360}});i.setScale(.15),i.explode(25),e.addSimulation(new M(this.scene,600,(()=>{i.destroy()})))}onTileSwap(e){}},I=class extends f{constructor(e,t,i,s){super(e,t,i,s),this.popTilesUp=[],this.popTilesDown=[]}onTilePop(){let e=this.tile.getTileGrid(),t=e.getTileIndex(this.tile,!0);this.tileIndex=t;for(let i=t.y+1;i<e.getRowCount();i++){let s=e.getTileAtIndex(t.x,i);null!=s&&s!=this.tile&&this.popTilesDown.push(s)}for(let i=t.y-1;i>=0;i--){let s=e.getTileAtIndex(t.x,i);null!=s&&s!=this.tile&&this.popTilesUp.push(s)}e.popTiles(this.popTilesUp),e.popTiles(this.popTilesDown)}onTileDestroy(){let e=this.scene.data.get("simulationController"),t=this.tile.getWorldPosition(),i=this.tile.getTileGrid(),s=this.scene.add.image(t.tx,t.ty,"stripes_destroy");s.setRotation(Math.PI/2),s.setOrigin(0,.5);let l=new Set;const r=e=>{const t=e.getValue(),s=e.targets;l.has(Math.floor(t))||i.destroyPopTile(s[Math.floor(t)])};let n=this.scene.tweens.chain({tweens:[{targets:s,y:{from:t.ty,to:t.ty+200},scaleY:{from:1,to:1.5},scaleX:{from:1,to:5},duration:350,ease:"Cubic.in"},{targets:s,y:{from:t.ty+200,to:t.ty+400},duration:350,ease:"Cubic.out"}]}),o=this.scene.add.image(t.tx,t.ty,"stripes_destroy");o.setRotation(-Math.PI/2),o.setOrigin(0,.5);let h=this.scene.tweens.chain({tweens:[{targets:o,y:{from:t.ty,to:t.ty-200},scaleY:{from:1,to:1.5},scaleX:{from:1,to:5},duration:350,ease:"Cubic.in"},{targets:o,y:{from:t.ty-200,to:t.ty-400},duration:350,ease:"Cubic.out"}]}),a=this.scene.add.tween({targets:this.popTilesUp,values:{from:0,to:this.popTilesUp.length-1},duration:500,ease:"Cubic.easeInOut",onUpdate:r}),d=this.scene.add.tween({targets:this.popTilesDown,values:{from:0,to:this.popTilesDown.length-1},duration:500,ease:"Cubic.easeInOut",onUpdate:r});e.addSimulation(new x(n),!0),e.addSimulation(new x(h),!0),e.addSimulation(new C(a),!0),e.addSimulation(new C(d),!0),this.scene.time.delayedCall(700,(()=>{s.destroy(),o.destroy()}))}},v=class{constructor(e,t,i,s){this.scene=e,this.colors=t,this.textureWidth=i,this.textureHeight=s}createRandomTile(e,t){let i=this.colors[Phaser.Math.RND.between(0,this.colors.length-1)],s=o.normalCandyTextureKey[i],l=new d({scene:this.scene,x:e,y:t,texture:s});return l.setDisplaySize(this.textureWidth,this.textureHeight).setTileEffect(new E(this.scene,l,i,s)),l}createSpecialTile(e,t,i,s){let l=this.getSpecialTileTexture(t,e),r=new d({scene:this.scene,x:i,y:s,texture:l});r.setDisplaySize(this.textureWidth,this.textureHeight);let n=this.getSpecialTileEffect(t,e,r);return r.setTileEffect(n),r}getSpecialTileTexture(e,t){switch(e){case"BOMB":return o.bombCandyTextureKey[t];case"COLOR_CLEAR":return o.cholateCandyTextureKey;case"COLUMN_CLEAR":return o.verticalStripesCandyTextureKey[t];case"ROW_CLEAR":return o.horizontalStripesCandyTextureKey[t];case"RANDOM_2":return o.bearCandyTextureKey[t];default:return o.normalCandyTextureKey[t]}}getSpecialTileEffect(e,t,i){switch(e){case"BOMB":return new S(this.scene,i,t,o.bombCandyTextureKey[t]);case"COLOR_CLEAR":return new E(this.scene,i,t,o.cholateCandyTextureKey);case"COLUMN_CLEAR":return new I(this.scene,i,t,o.verticalStripesCandyTextureKey[t]);case"ROW_CLEAR":return new G(this.scene,i,t,o.horizontalStripesCandyTextureKey[t]);case"RANDOM_2":return new w(this.scene,i,t,o.bearCandyTextureKey[t]);default:return new E(this.scene,i,t,o.normalCandyTextureKey[t])}}};class b extends Phaser.GameObjects.GameObject{constructor(e){super(e,"SimulationController"),this.simulations=[],this.hasStarted=!1,this.hasEnded=!1,this.hasCompleted=!1,this.nextSimulations=[],this.hasInvokeNextStart=!1,this.simulations=[],this.scene.events.on("update",this.update,this)}update(...e){this.hasInvokeNextStart&&this.hasEnded&&(this.simulations=this.nextSimulations,this.nextSimulations=[],this.startSimulation()),this.getCompleted()&&this.hasStarted&&!this.hasCompleted&&(this.hasCompleted=!0,this.clear(),this.emit("complete"),0==this.simulations.length?(this.hasEnded=!0,this.hasStarted=!1):this.hasEnded=!1),this.getCompleted()&&this.hasStarted&&this.hasCompleted&&!this.hasEnded&&(this.hasEnded=!0,this.hasStarted=!1)}addSimulation(e,t=!1){return this.hasCompleted?this.hasCompleted&&!this.hasEnded&&t?(this.simulations.push(e),void e.start()):void this.nextSimulations.push(e):(this.simulations.push(e),void e.start())}startSimulation(){this.hasStarted?this.hasInvokeNextStart=!0:(this.hasStarted=!0,this.hasInvokeNextStart=!1,this.hasCompleted=!1,this.hasEnded=!1,0==this.simulations.length&&0!=this.nextSimulations.length&&(this.simulations=this.nextSimulations,this.nextSimulations=[]),this.simulations.forEach((e=>{e.start()})))}removeSimulation(e){this.simulations=this.simulations.filter((t=>t!==e))}stopSimulation(){this.simulations.forEach((e=>{e.stop()})),this.hasStarted=!1}getCompleted(){let e=!0;return this.simulations.forEach((t=>{t.getCompleted()||(e=!1)})),e}clear(){this.simulations=[]}getSimulations(){return this.simulations}}const A=b;class O extends Phaser.Scene{constructor(){super({key:"GameScene"})}create(){this.initializeVariables(),this.setBackground(),this.initializeGrid(),this.startCheckMatch()}initializeVariables(){this.simulationController=new A(this),this.tileFactory=new v(this,n,o.tileWidth,o.tileHeight),this.tileGrid=new g(this,400,100,o.gridWidth,o.gridHeight,o.tileWidth,o.tileHeight,this.tileFactory,["item-spot-01","item-spot-02"]),this.tileMatcher=new m(this.tileGrid),this.tileSwapper=new y(this,this.tileGrid),this.gameInputHandler=new p(this,this.tileSwapper),this.data.set("simulationController",this.simulationController)}setBackground(){this.cameras.main.setBackgroundColor(7908062);const e=this.add.image(0,0,"background-01");e.setOrigin(0,0),e.setDisplaySize(this.game.canvas.width,this.game.canvas.height),e.setDepth(-100)}initializeGrid(){this.tileGrid.on(g.TILE_ADD_EVENT,this.tweenDropdownTile,this),this.tileGrid.on(g.TILE_GRAVITATE_EVENT,this.tweenDropdownTile,this),this.tileGrid.on(g.TILE_SWAP_EVENT,this.tweenSwapTiles,this),this.tileGrid.initializeTiles()}checkMatches(){let e=this.tileMatcher.getMatches();if(e.length>0){let t=new Map;return e.forEach((e=>{"NONE"!==e.specialTileType&&t.set(e.originTile,{x:e.originTile.x,y:e.originTile.y}),this.tileGrid.popTiles(e.matchTiles)})),e.forEach((e=>{if("NONE"!==e.specialTileType){let i=this.tileFactory.createSpecialTile(e.originTile.getColor(),e.specialTileType,e.originTile.x,e.originTile.y);this.tileGrid.addTileAtLocalPosition(i,t.get(e.originTile).x,t.get(e.originTile).y)}})),this.tileGrid.gravitateTile(),this.tileGrid.fillEmptyGridWithTile(),e.forEach((e=>{e.matchTiles.forEach((e=>{e.destroy()}))})),!0}return!1}startCheckMatch(){this.tileSwapper.setCanMove(!1);const e=()=>{this.simulationController.off("complete",e),this.checkMatches()?this.startCheckMatch():this.tileSwapper.setCanMove(!0)};this.simulationController.on("complete",e),this.simulationController.startSimulation()}tweenDropdownTile(e,t,i,s,l){const r=new x(this.tweens.chain({tweens:[{targets:e,y:(l+.5)*o.tileHeight,ease:"Cubic.In",duration:Math.max(150*(l-i),300),repeat:0,yoyo:!1}],onActive:()=>{console.log("Disable Tile Interaction"),e.disableTileInteraction()},onComplete:()=>{var t;null===(t=e.getMapTween("displaySize"))||void 0===t||t.stop();const i=e.displayHeight,s=e.displayWidth;let l=this.tweens.add({targets:e,displayHeight:.8*i,displayWidth:1.2*s,ease:"Quad.Out",duration:100,yoyo:!0,repeat:0,onComplete:()=>{console.log("Enable Tile Interaction"),e.removeMapTween("displaySize"),e.enableTileInteraction()},onStop:()=>{e.setDisplaySize(s,i),e.removeMapTween("displaySize")}});e.addMapTween("displaySize",l)}}));this.simulationController.addSimulation(r)}tweenSwapTiles(e,t){const i=new C(this.add.tween({targets:e,x:t.x,y:t.y,ease:"Linear",duration:250,repeat:0,yoyo:!1})),s=new C(this.add.tween({targets:t,x:e.x,y:e.y,ease:"Linear",duration:250,repeat:0,yoyo:!1}));this.simulationController.addSimulation(i),this.simulationController.addSimulation(s);const l=()=>{this.simulationController.off("complete",l),this.checkMatches()?(this.tileSwapper.resetSelectedTile(),this.startCheckMatch()):this.tileSwapper.checkIsSwapped()?this.tileSwapper.unswapTiles():(this.tileSwapper.resetSelectedTile(),this.tileSwapper.setCanMove(!0))};this.simulationController.on("complete",l),this.simulationController.startSimulation()}}const P=O,V={title:"Candy crush",url:"https://github.com/digitsensitive/phaser3-typescript",version:"0.0.1",type:Phaser.AUTO,autoCenter:Phaser.Scale.CENTER_BOTH,scale:{mode:Phaser.Scale.FIT,width:1400,height:787.5},parent:"game",scene:[r,P],backgroundColor:"#de3412",render:{pixelArt:!1,antialias:!0}};class N extends Phaser.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new N(V)}))}},i={};function s(e){var l=i[e];if(void 0!==l)return l.exports;var r=i[e]={exports:{}};return t[e].call(r.exports,r,r.exports,s),r.exports}s.m=t,e=[],s.O=(t,i,l,r)=>{if(!i){var n=1/0;for(d=0;d<e.length;d++){for(var[i,l,r]=e[d],o=!0,h=0;h<i.length;h++)(!1&r||n>=r)&&Object.keys(s.O).every((e=>s.O[e](i[h])))?i.splice(h--,1):(o=!1,r<n&&(n=r));if(o){e.splice(d--,1);var a=l();void 0!==a&&(t=a)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[i,l,r]},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={792:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var l,r,[n,o,h]=i,a=0;if(n.some((t=>0!==e[t]))){for(l in o)s.o(o,l)&&(s.m[l]=o[l]);if(h)var d=h(s)}for(t&&t(i);a<n.length;a++)r=n[a],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return s.O(d)},i=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var l=s.O(void 0,[96],(()=>s(116)));l=s.O(l)})();