(()=>{"use strict";var e,t={271:(e,t,i)=>{var s=i(440);class l extends Phaser.Scene{constructor(){super({key:"BootScene"})}preload(){this.cameras.main.setBackgroundColor(10016391),this.createLoadingbar(),this.load.on("progress",(e=>{this.progressBar.clear(),this.progressBar.fillStyle(16774867,1),this.progressBar.fillRect(this.cameras.main.width/4,this.cameras.main.height/2-16,this.cameras.main.width/2*e,16)}),this),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy()}),this),this.load.pack("preload","./assets/pack.json","preload"),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy(),this.scene.start("GameScene")}),this)}create(){this.createAnimations()}createLoadingbar(){this.loadingBar=this.add.graphics(),this.loadingBar.fillStyle(6139463,1),this.loadingBar.fillRect(this.cameras.main.width/4-2,this.cameras.main.height/2-18,this.cameras.main.width/2+4,20),this.progressBar=this.add.graphics()}createAnimations(){this.anims.create({key:"indicator-animation",frames:[{key:"indicator-0"},{key:"indicator-1"},{key:"indicator-2"},{key:"indicator-3"}],frameRate:10,repeat:-1});let e=[];for(let t=5;t<=17;t++)e.push({key:`boom-${t.toString().padStart(2,"0")}`});this.anims.create({key:"bomb-animation",frames:e,frameRate:15}),this.anims.create({key:"lightning-blast",frames:this.anims.generateFrameNumbers("lightning-1-sheet",{start:0,end:8}),frameRate:10}),this.anims.create({key:"lightning-strike-start",frames:this.anims.generateFrameNumbers("lightning-2-sheet",{start:0,end:1}),frameRate:10}),this.anims.create({key:"lightning-strike-loop",frames:this.anims.generateFrameNumbers("lightning-2-sheet",{start:2,end:4}),frameRate:10,repeat:-1}),this.anims.create({key:"lightning-strike-end",frames:this.anims.generateFrameNumbers("lightning-2-sheet",{start:5,end:8}),frameRate:10}),this.anims.create({key:"lightning-bolt",frames:this.anims.generateFrameNumbers("lightning-3-sheet",{start:0,end:15}),frameRate:10})}}const r=l,h=["red","yellow","green","purple","blue"],n={score:0,highscore:0,gridWidth:8,gridHeight:8,tileWidth:72,tileHeight:72,candyColors:["red","yellow","green","purple","blue","orange"],normalCandyTextureKey:{red:"item-01",yellow:"item-02",green:"item-03",purple:"item-04",blue:"item-05",orange:"item-06"},verticalStripesCandyTextureKey:{red:"item-01-stripes-vert",yellow:"item-02-stripes-vert",green:"item-03-stripes-vert",purple:"item-04-stripes-vert",blue:"item-05-stripes-vert",orange:"item-06-stripes-vert"},horizontalStripesCandyTextureKey:{red:"item-01-stripes-horiz",yellow:"item-02-stripes-horiz",green:"item-03-stripes-horiz",purple:"item-04-stripes-horiz",blue:"item-05-stripes-horiz",orange:"item-06-stripes-horiz"},bombCandyTextureKey:{red:"bomb-items-01",yellow:"bomb-items-02",green:"bomb-items-03",purple:"bomb-items-04",blue:"bomb-items-05",orange:"bomb-items-06"},bearCandyTextureKey:{red:"item-mar-01",yellow:"item-mar-02",green:"item-mar-03",purple:"item-mar-04",blue:"item-mar-05",orange:"item-mar-06"},cholateCandyTextureKey:"game-item-h",itemSpot1TextureKey:"item-spot",itemSpot2TextureKey:"item-spot-2"},o=class{static applyImageScaleTweens(e,t,i,s=e.scaleX,l=e.scaleY,r=.95,h=100){let n,o=!1,a=null,d=null;const c=()=>{d&&d.complete(),n=new Phaser.Math.Vector2(s,l);const t=n.x*r,i=n.y*r;o=!0,a=e.scene.tweens.add({targets:e,scaleX:t,scaleY:i,duration:h,ease:"Linear",onComplete:()=>{e.setScale(t,i),a=null}})},p=()=>{o&&(a&&a.stop(),o=!1,d=e.scene.tweens.add({targets:e,scaleX:n.x,scaleY:n.y,duration:h,ease:"Linear",onComplete:()=>{e.setScale(n.x,n.y),d=null}}))};"string"==typeof t&&(t=[t]),t.forEach((t=>{e.on(t,c)})),"string"==typeof i&&(i=[i]),i.forEach((t=>{e.on(t,p)}))}static applyImageDisplaySizeTweens(e,t,i,s=e.displayWidth,l=e.displayHeight,r=.95,h=100){let n,o=!1,a=null,d=null;const c=()=>{d&&d.complete(),n=new Phaser.Math.Vector2(s,l);const t=n.x*r,i=n.y*r;o=!0,a=e.scene.tweens.add({targets:e,displayWidth:t,displayHeight:i,duration:h,ease:"Linear",onComplete:()=>{e.setDisplaySize(t,i),a=null}})},p=()=>{o&&(a&&a.stop(),o=!1,d=e.scene.tweens.add({targets:e,displayWidth:n.x,displayHeight:n.y,duration:h,ease:"Linear",onComplete:()=>{e.setDisplaySize(n.x,n.y),d=null}}))};"string"==typeof t&&(t=[t]),t.forEach((t=>{e.on(t,c)})),"string"==typeof i&&(i=[i]),i.forEach((t=>{e.on(t,p)}))}};class a extends Phaser.GameObjects.Image{constructor(e){super(e.scene,e.x,e.y,e.texture,e.frame),this.tileWidth=0,this.tileHeight=0,this.mapTween=new Map,this.isPointerOver=!1,this.isDestroyed=!1,this.isPop=!1,this.lastMoveTime=0,this.lastMoveTime=this.scene.time.now,this.setOrigin(.5,.5),this.scene.add.existing(this)}disableTileInteraction(){this.isDestroyed||(this.disableInteractive(),this.isPointerOver&&this.emit("pointerout"),this.off("pointerover"),this.off("pointerout"))}setLastMoveTime(e){this.lastMoveTime=e}getLastMoveTime(){return this.lastMoveTime}enableTileInteraction(){this.isDestroyed||(this.setInteractive(),this.on("pointerover",this.onPointerOver,this),this.on("pointerout",this.onPointerOut,this),o.applyImageDisplaySizeTweens(this,"pointerover","pointerout",this.tileWidth,this.tileHeight,1.1,100))}addMapTween(e,t){this.mapTween.set(e,t)}getMapTween(e){return this.mapTween.get(e)}removeMapTween(e){this.mapTween.delete(e)}onPointerOver(){this.isPointerOver=!0}onPointerOut(){this.isPointerOver=!1}setTileEffect(e){return this.tileEffect=e,this}setAppear(e=[]){return this.tileEffect.onTileAppear(e),this}setTileGrid(e,t,i){return this.grid=e,this.tileWidth=t,this.tileHeight=i,this.enableTileInteraction(),this}getWorldPosition(){const e=this.grid.getWorldTransformMatrix();let t=this.getLocalTransformMatrix();return t.tx+=e.tx,t.ty+=e.ty,t}getTileGrid(){return this.grid}getTileWidth(){return this.tileWidth}getTileHeight(){return this.tileHeight}getColor(){return this.tileEffect.color}getTileEffect(){return this.tileEffect}pop(){this.isPop||(this.isPop=!0,this.tileEffect.onTilePop())}swapPop(e){this.tileEffect.onTileSwapPop(e.getTileEffect())}destroy(e,t,i=!0){this.isDestroyed||(this.isDestroyed=!0,i&&this.tileEffect.onTileDestroy(t),super.destroy(e))}}const d=a;class c extends Phaser.Events.EventEmitter{constructor(e,t){super(),this.timeoutDuration=3e3,this.scene=e,this.tileSwapper=t,this.selectingTile=null,this.indicator=this.scene.add.sprite(0,0,"indicator-0"),this.indicator.setVisible(!1),this.indicator.setScale(2.3),this.indicator.play("indicator-animation"),this.createTimer(),this.registerInputEvents(e),this.on(c.CLICKED_INPUT_EVENT,(()=>{this.resetTimer()}))}createTimer(){this.timer=this.scene.time.addEvent({delay:this.timeoutDuration,loop:!0,callback:()=>{this.emit(c.NO_INPUT_PERIOD_EVENT)}})}registerInputEvents(e){e.input.on("gameobjectdown",((e,t,i)=>{if(this.emit(c.CLICKED_INPUT_EVENT),!0===this.tileSwapper.getCanMove()){if(this.tileSwapper.selectTile(t),this.tileSwapper.checkIsSwapped())this.selectingTile=null,this.indicator.setVisible(!1);else{this.selectingTile=t,this.indicator.setVisible(!0);let i=this.selectingTile.getWorldTransformMatrix();this.indicator.setPosition(i.tx,i.ty),this.downPosition=new Phaser.Math.Vector2(e.x,e.y)}this.tileSwapper.checkFirstTileSelected()||(this.selectingTile=null,this.indicator.setVisible(!1))}})),e.input.on("gameobjectup",((e,t,i)=>{this.emit(c.CLICKED_INPUT_EVENT),this.tileSwapper.getCanMove()&&this.selectingTile&&this.selectingTile!==t&&(this.tileSwapper.selectTile(t),this.selectingTile=null,this.indicator.setVisible(!1))})),e.input.on("pointerover",((e,t)=>{t.forEach((e=>{e instanceof d&&this.tileSwapper.getCanMove()&&this.selectingTile&&this.selectingTile!==e&&(this.tileSwapper.selectTile(e),this.selectingTile=null,this.indicator.setVisible(!1))}))}))}resetTimer(){this.timer.reset({delay:this.timeoutDuration,loop:!0,callback:()=>{this.emit(c.NO_INPUT_PERIOD_EVENT)}})}stopTimer(){this.timer.paused=!0,this.timer.reset({delay:this.timeoutDuration,loop:!0,callback:()=>{this.emit(c.NO_INPUT_PERIOD_EVENT)}})}startTimer(){this.timer.paused=!1}}c.NO_INPUT_PERIOD_EVENT="no input period",c.CLICKED_INPUT_EVENT="clicked input";const p=c;class g extends s.GameObjects.Container{constructor(e,t,i,s,l,r,h,n,o=[]){super(e,t,i),this.scene=e,this.gridWidth=s,this.gridHeight=l,this.tileWidth=r,this.tileHeight=h,this.tileFactory=n,this.gridTextures=o,this.scene.add.existing(this),this.initializeGrid()}initializeGrid(){if(0!=this.gridTextures.length)if(1===this.gridTextures.length)for(let e=0;e<this.gridHeight;e++)for(let t=0;t<this.gridWidth;t++){let i=this.scene.add.image(t*this.tileWidth,e*this.tileHeight,this.gridTextures[0]);i.setDisplaySize(this.tileWidth,this.tileHeight),i.setOrigin(0,0),this.add(i),this.sendToBack(i)}else if(2===this.gridTextures.length)for(let e=0;e<this.gridHeight;e++)for(let t=0;t<this.gridWidth;t++){let i=this.scene.add.image(t*this.tileWidth,e*this.tileHeight,this.gridTextures[(t+e)%2]);i.setDisplaySize(this.tileWidth,this.tileHeight),i.setOrigin(0,0),this.add(i),this.sendToBack(i)}}initializeTiles(){this.tileGrid=[];for(let e=0;e<this.gridHeight;e++){this.tileGrid[e]=[];for(let t=0;t<this.gridWidth;t++){let i=this.createRandomTile(t,e-this.gridHeight);this.tileGrid[e][t]=i,this.emit(g.TILE_ADD_EVENT,i,t,e-this.gridHeight,t,e)}}this.popedTilesGrid=[];for(let e=0;e<this.gridHeight;e++){this.popedTilesGrid[e]=[];for(let t=0;t<this.gridWidth;t++)this.popedTilesGrid[e][t]=null}this.emit(g.TILE_CHANGE_EVENT)}getTileIndex(e,t=!1){let i=null;for(let t=0;t<this.tileGrid.length;t++)for(let s=0;s<this.tileGrid[t].length;s++)if(e===this.tileGrid[t][s])return i=new Phaser.Math.Vector2(s,t),i;if(t)for(let t=0;t<this.popedTilesGrid.length;t++)for(let s=0;s<this.popedTilesGrid[t].length;s++)if(e===this.popedTilesGrid[t][s])return i=new Phaser.Math.Vector2(s,t),i;return i}getTileIndexInPopedGrid(e){let t=null;for(let i=0;i<this.popedTilesGrid.length;i++)for(let s=0;s<this.popedTilesGrid[i].length;s++)if(e===this.popedTilesGrid[i][s])return t=new Phaser.Math.Vector2(s,i),t;return t}gravitateTile(){for(let e=this.tileGrid.length-1;e>=0;e--)for(let t=this.tileGrid[e].length-1;t>=0;t--){if(null!==this.tileGrid[e][t])continue;let i=null,s=e-1;for(let l=e-1;l>=0&&null===i;l--)i=this.tileGrid[l][t],s=l;null!==i&&(this.tileGrid[e][t]=i,this.tileGrid[s][t]=null,this.emit(g.TILE_GRAVITATE_EVENT,i,t,s,t,e))}}fillEmptyGridWithTile(){for(var e=0;e<this.tileGrid.length;e++)for(var t=0;t<this.tileGrid[e].length;t++){if(null!==this.tileGrid[e][t])continue;let i=this.tileGrid.length;for(let s=e+1;s<this.tileGrid.length;s++)if(null!==this.tileGrid[s][t]){i=s;break}let s=this.createRandomTile(t,e-i);this.tileGrid[e][t]=s,this.emit(g.TILE_ADD_EVENT,s,t,e-i,t,e)}this.emit(g.TILE_CHANGE_EVENT)}destroyAllPopTiles(){for(let e=0;e<this.popedTilesGrid.length;e++)for(let t=0;t<this.popedTilesGrid[e].length;t++){const i=this.popedTilesGrid[e][t];null!==i&&(this.remove(i),i.destroy(),this.popedTilesGrid[e][t]=null)}}destroyPopTile(e,t,i=!0){let s=this.getTileIndexInPopedGrid(e);null!==s&&(this.remove(e),this.popedTilesGrid[s.y][s.x]=null,e.destroy(!0,t,i))}popTiles(e){for(var t=0;t<e.length;t++)this.popTile(e[t])}popTile(e){let t=this.getTileIndex(e);t&&(this.popedTilesGrid[t.y][t.x]=e,this.tileGrid[t.y][t.x]=null,e.pop())}swapPopTiles(e,t){let i=this.getTileIndex(e),s=this.getTileIndex(t);i&&s&&(this.popedTilesGrid[i.y][i.x]=e,this.popedTilesGrid[s.y][s.x]=t,this.tileGrid[i.y][i.x]=null,this.tileGrid[s.y][s.x]=null,e.swapPop(t),t.pop())}addTileAtIndex(e,t,i){void 0===i&&(i=Math.floor(t/this.gridWidth),t%=this.gridWidth),e.setTileGrid(this,this.tileWidth,this.tileHeight),e.setDisplaySize(this.tileWidth,this.tileHeight),e.setPosition((t+.5)*this.tileWidth,(i+.5)*this.tileHeight),this.add(e),this.tileGrid[i][t]=e}addTileAtWorldPosition(e,t,i){let s=Math.floor((t-this.x)/this.tileWidth),l=Math.floor((i-this.y)/this.tileHeight);l>=0&&l<this.tileGrid.length&&s>=0&&s<this.tileGrid[l].length&&this.addTileAtIndex(e,s,l)}addTileAtLocalPosition(e,t,i){let s=Math.floor((t+.5)/this.tileWidth),l=Math.floor((i+.5)/this.tileHeight);l>=0&&l<this.tileGrid.length&&s>=0&&s<this.tileGrid[l].length&&this.addTileAtIndex(e,s,l)}removeTileAtIndex(e,t){void 0===t&&(t=Math.floor(e/this.gridWidth),e%=this.gridWidth);let i=this.tileGrid[t][e];return null===i||(this.remove(i),this.tileGrid[t][e]=null),i}removeTile(e){let t=this.getTileIndex(e);null!==t&&(this.remove(e),this.tileGrid[t.y][t.x]=null)}swapTiles(e,t){if(!e||!t)return;let i=e.x,s=e.y,l=t.x,r=t.y;this.tileGrid[s/this.tileHeight-.5][i/this.tileWidth-.5]=t,this.tileGrid[r/this.tileHeight-.5][l/this.tileWidth-.5]=e,this.emit(g.TILE_SWAP_EVENT,e,t),this.emit(g.TILE_CHANGE_EVENT)}getRandomTileInPopedGrid(){let e=[];for(let t=0;t<this.popedTilesGrid.length;t++)for(let i=0;i<this.popedTilesGrid[t].length;i++)null!==this.popedTilesGrid[t][i]&&e.push(this.popedTilesGrid[t][i]);return 0===e.length?null:e[Math.floor(Math.random()*e.length)]}getTileGrid(){return this.tileGrid}getFlattenTileGrid(){let e=[];for(let t=0;t<this.tileGrid.length;t++)for(let i=0;i<this.tileGrid[t].length;i++)null!==this.tileGrid[t][i]&&e.push(this.tileGrid[t][i]);return e}getPopedTileGrid(){return this.popedTilesGrid}getDistance(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}getMahattanDistance(e,t){return new Phaser.Math.Vector2(Math.abs(e.x-t.x),Math.abs(e.y-t.y))}getMahattanIndexDistance(e,t){return new Phaser.Math.Vector2(Math.abs(e.x-t.x)/this.tileWidth,Math.abs(e.y-t.y)/this.tileHeight)}getRow(e){return this.tileGrid[e]}getColumn(e){let t=[];for(let i=0;i<this.tileGrid.length;i++)t.push(this.tileGrid[i][e]);return t}getTileAtIndex(e,t){return t<0||t>=this.tileGrid.length||e<0||e>=this.tileGrid[t].length?null:this.tileGrid[t][e]}getTileAtWorldPosition(e,t){let i=null,s=Math.floor((e-this.x)/this.tileWidth),l=Math.floor((t-this.y)/this.tileHeight);return l>=0&&l<this.tileGrid.length&&s>=0&&s<this.tileGrid[l].length&&(i=this.tileGrid[l][s]),i}getWorldPositionFromIndex(e,t){return void 0===t&&(t=Math.floor(e/this.gridWidth),e%=this.gridWidth),new Phaser.Math.Vector2((e+.5)*this.tileWidth+this.x,(t+.5)*this.tileHeight+this.y)}getWorldPositionFromTile(e){return new Phaser.Math.Vector2(e.x+this.x,e.y+this.y)}getLocalPositionFromIndex(e,t){return new Phaser.Math.Vector2((e+.5)*this.tileWidth,(t+.5)*this.tileHeight)}getRowCount(){return this.gridHeight}getColumnCount(){return this.gridWidth}createRandomTile(e,t){let i=this.tileFactory.createRandomTile((e+.5)*this.tileWidth,(t+.5)*this.tileHeight);return i.setTileGrid(this,this.tileWidth,this.tileHeight),this.add(i),i.setAppear(),i}}g.TILE_CHANGE_EVENT="tileChange",g.TILE_SWAP_EVENT="tileSwap",g.TILE_ADD_EVENT="tileAdd",g.TILE_GRAVITATE_EVENT="tileGravitate";const u=g,T=class{constructor(e,t){this.tiles=t,this.scene=e}start(){}stop(){}getCompleted(){return!1}update(){}getFlattenTiles(){return this.tiles.reduce(((e,t)=>{let i=t.filter((e=>null!==e));return e.concat(i)}),[])}},m=class extends T{constructor(){super(...arguments),this.tweens=[]}start(){super.start();const e=this.tiles.length,t=this.tiles.reduce(((e,t)=>Math.max(e,t.length)),0);for(let i=0;i<=e+t-2;++i){let s=Math.max(0,i-t+1),l=Math.min(e-1,i);for(let e=s;e<=l;++e){let t=i-e;if(t<0||t>=this.tiles[e].length||null===this.tiles[e][t])continue;let s=this.createWaveTween(this.tiles[e][t],i);this.tweens.push(s)}}}createWaveTween(e,t){return this.scene.tweens.add({targets:e,delay:100*t,displayWidth:1.2*e.getTileWidth(),displayHeight:1.2*e.getTileHeight(),yoyo:!0,ease:"Quad.InOut",duration:150,onComplete:()=>{e.setDisplaySize(e.getTileWidth(),e.getTileHeight())}})}};class y extends s.GameObjects.Graphics{constructor(e,t,i,s){super(e),this.scene=e,this.x=t,this.y=i,this.index=s}}const f=y,x=class extends T{constructor(e,t,i,s,l,r,h=(()=>{})){super(e,t.getTileGrid()),this.tileGrid=t,this.x=i,this.y=s,this.radius=l,this.duration=r,this.callback=h}start(){super.start();let e=[],t=[],i=this.scene.add.graphics();i.fillRect(400,70,n.gridWidth*n.tileWidth,(n.gridHeight+1)*n.tileHeight),i.fillStyle(16777215);let s=this.getFlattenTiles();s.forEach((s=>{s.disableTileInteraction();let l=this.tileGrid.getWorldPositionFromTile(s),r=this.tileGrid.getTileIndex(s);null!==r?(this.tileGrid.removeTile(s),s.setMask(i.createGeometryMask()),s.setPosition(l.x,l.y),e.push(new f(this.scene,l.x,l.y,r)),t.push(new f(this.scene,this.x,this.y,r))):console.error("TileCircleShuffleSimulation: Tile is not in the grid")})),Phaser.Utils.Array.Shuffle(s),Phaser.Utils.Array.Shuffle(t);const l=this.scene.add.group(e),r=(this.scene.add.group(t),this.scene.add.group(s)),h=new Phaser.Geom.Circle(this.x,this.y,this.radius);Phaser.Actions.PlaceOnCircle(l.getChildren(),h);let o=0;s.forEach(((i,l)=>{const n=e[l].getWorldTransformMatrix(),a=t[l],d=this.tileGrid.getWorldPositionFromIndex(a.index.x,a.index.y);this.scene.tweens.chain({tweens:[{targets:i,x:n.tx,y:n.ty,ease:Phaser.Math.Easing.Cubic.InOut,duration:this.duration/4},{targets:h,radius:this.radius,ease:"Linear",duration:this.duration/2,onUpdate:()=>{Phaser.Actions.RotateAroundDistance(r.getChildren(),{x:this.x,y:this.y},6e-4,h.radius)}},{targets:i,x:d.x,y:d.y,ease:Phaser.Math.Easing.Cubic.InOut,duration:this.duration/4}],onComplete:()=>{this.tileGrid.addTileAtIndex(i,a.index.x,a.index.y),i.enableTileInteraction(),i.clearMask(),++o===s.length&&this.callback()}})}))}},S=class extends T{constructor(e,t,i,s,l,r,h=(()=>{})){super(e,t.getTileGrid()),this.tileGrid=t,this.x=i,this.y=s,this.size=l,this.duration=r,this.callback=h}start(){super.start();let e=[],t=[],i=this.scene.add.graphics();i.fillRect(400,70,n.gridWidth*n.tileWidth,(n.gridHeight+1)*n.tileHeight),i.fillStyle(16777215);let s=this.getFlattenTiles();s.forEach((s=>{s.disableTileInteraction();let l=this.tileGrid.getWorldPositionFromTile(s),r=this.tileGrid.getTileIndex(s);null!==r?(this.tileGrid.removeTile(s),s.setMask(i.createGeometryMask()),s.setPosition(l.x,l.y),e.push(new f(this.scene,l.x,l.y,r)),t.push(new f(this.scene,this.x,this.y,r))):console.error("TileSquareShuffleSimulation: Tile is not in the grid")})),Phaser.Utils.Array.Shuffle(s),Phaser.Utils.Array.Shuffle(t);const l=this.scene.add.group(e),r=(this.scene.add.group(t),this.scene.add.group(s),new Phaser.Geom.Rectangle(this.x-this.size/2,this.y-this.size/2,this.size,this.size));Phaser.Actions.PlaceOnRectangle(l.getChildren(),r);let h=0;s.forEach(((i,l)=>{const n=e[l].getWorldTransformMatrix(),o=t[l],a=this.tileGrid.getWorldPositionFromIndex(o.index.x,o.index.y);this.scene.tweens.chain({tweens:[{targets:i,x:n.tx,y:n.ty,ease:Phaser.Math.Easing.Cubic.InOut,duration:this.duration/4},{targets:r,value:{from:0,to:1},ease:Phaser.Math.Easing.Linear,duration:this.duration/2,onUpdate:e=>{let t=e.getValue();t+=l/s.length,t>=1&&(t-=1);let h=new Phaser.Geom.Point;r.getPoint(t,h);let n=Math.sqrt(Math.pow(h.x-r.centerX,2)+Math.pow(h.y-r.centerY,2)),o=(Math.atan((h.y-r.centerY)/(h.x-r.centerX)),Math.atan2(h.y-r.centerY,h.x-r.centerX)+2*Math.PI*e.getValue()),a=n*Math.cos(o),d=n*Math.sin(o);h.x=a+r.centerX,h.y=d+r.centerY,i.setPosition(h.x,h.y)}},{targets:i,x:a.x,y:a.y,ease:Phaser.Math.Easing.Cubic.InOut,duration:this.duration/4}],onComplete:()=>{this.tileGrid.addTileAtIndex(i,o.index.x,o.index.y),i.enableTileInteraction(),i.clearMask(),++h===s.length&&this.callback()}})}))}},C=class extends T{constructor(e,t,i,s,l,r,h=(()=>{})){super(e,t.getTileGrid()),this.tileGrid=t,this.x=i,this.y=s,this.size=l,this.duration=r,this.callback=h}start(){super.start();let e=[],t=[],i=this.scene.add.graphics();i.fillRect(400,70,n.gridWidth*n.tileWidth,(n.gridHeight+1)*n.tileHeight),i.fillStyle(16777215);let s=this.getFlattenTiles();s.forEach((s=>{s.disableTileInteraction();let l=this.tileGrid.getWorldPositionFromTile(s),r=this.tileGrid.getTileIndex(s);null!==r?(this.tileGrid.removeTile(s),s.setMask(i.createGeometryMask()),s.setPosition(l.x,l.y),e.push(new f(this.scene,l.x,l.y,r)),t.push(new f(this.scene,this.x,this.y,r))):console.error("TileSquareShuffleSimulation: Tile is not in the grid")})),Phaser.Utils.Array.Shuffle(s),Phaser.Utils.Array.Shuffle(t),this.scene.add.group(e),this.scene.add.group(t),this.scene.add.group(s);const l=this.createStar(this.x,this.y,5,this.size/2,this.size);e.forEach(((t,i)=>{let s=this.getPoint(l,i/e.length);t.setPosition(s.x,s.y)}));let r=0;s.forEach(((i,h)=>{const n=e[h].getWorldTransformMatrix(),o=t[h],a=this.tileGrid.getWorldPositionFromIndex(o.index.x,o.index.y);this.scene.tweens.chain({tweens:[{targets:i,x:n.tx,y:n.ty,ease:Phaser.Math.Easing.Cubic.InOut,duration:this.duration/4},{targets:i,values:{from:0,to:1},ease:Phaser.Math.Easing.Linear,duration:this.duration/2,onUpdate:e=>{let t=e.getValue();if(null==t)return;t+=h/s.length,t>=1&&(t-=1);let r=this.getPoint(l,t),n=Math.sqrt(Math.pow(r.x-this.x,2)+Math.pow(r.y-this.y,2)),o=(Math.atan((r.y-this.y)/(r.x-this.x)),Math.atan2(r.y-this.y,r.x-this.x)+2*Math.PI*e.getValue()),a=n*Math.cos(o),d=n*Math.sin(o);r.x=a+this.x,r.y=d+this.y,i.setPosition(r.x,r.y)}},{targets:i,x:a.x,y:a.y,ease:Phaser.Math.Easing.Cubic.InOut,duration:this.duration/4}],onComplete:()=>{this.tileGrid.addTileAtIndex(i,o.index.x,o.index.y),i.enableTileInteraction(),i.clearMask(),++r===s.length&&this.callback()}})}))}createStar(e,t,i,s,l){let r=[],h=Math.PI/i;for(let n=0;n<2*i;n++){let i=n%2==0?l:s,o=h*n,a=new Phaser.Geom.Point;a.setTo(e+i*Math.cos(o),t+i*Math.sin(o)),r.push(a)}return r}getPoint(e,t){let i=Math.floor(t*e.length),s=e[i],l=e[(i+1)%e.length],r=t*e.length%1;return this.interpolatePoint(s,l,r)}interpolatePoint(e,t,i){return new Phaser.Geom.Point(e.x+(t.x-e.x)*i,e.y+(t.y-e.y)*i)}},w=class extends T{constructor(e,t,i,s,l,r,h=(()=>{})){super(e,t.getTileGrid()),this.tileGrid=t,this.x=i,this.y=s,this.size=l,this.duration=r,this.callback=h}start(){super.start();let e=[],t=[],i=this.scene.add.graphics();i.fillRect(400,70,n.gridWidth*n.tileWidth,(n.gridHeight+1)*n.tileHeight),i.fillStyle(16777215);let s=this.getFlattenTiles();s.forEach((s=>{s.disableTileInteraction();let l=this.tileGrid.getWorldPositionFromTile(s),r=this.tileGrid.getTileIndex(s);null!==r?(this.tileGrid.removeTile(s),s.setMask(i.createGeometryMask()),s.setPosition(l.x,l.y),e.push(new f(this.scene,l.x,l.y,r)),t.push(new f(this.scene,this.x,this.y,r))):console.error("TileSquareShuffleSimulation: Tile is not in the grid")})),Phaser.Utils.Array.Shuffle(s),Phaser.Utils.Array.Shuffle(t),this.scene.add.group(e),this.scene.add.group(t),this.scene.add.group(s);const l=this.createHourglass(this.x,this.y,this.size);e.forEach(((t,i)=>{let s=this.getPoint(l,i/e.length);t.setPosition(s.x,s.y)}));let r=0;s.forEach(((i,h)=>{const n=e[h].getWorldTransformMatrix(),o=t[h],a=this.tileGrid.getWorldPositionFromIndex(o.index.x,o.index.y);this.scene.tweens.chain({tweens:[{targets:i,x:n.tx,y:n.ty,ease:Phaser.Math.Easing.Cubic.InOut,duration:this.duration/4},{targets:i,values:{from:0,to:1},ease:Phaser.Math.Easing.Linear,duration:this.duration/2,onUpdate:e=>{let t=e.getValue();if(null==t)return;t+=h/s.length,t>=1&&(t-=1);let r=this.getPoint(l,t),n=Math.sqrt(Math.pow(r.x-this.x,2)+Math.pow(r.y-this.y,2)),o=(Math.atan((r.y-this.y)/(r.x-this.x)),Math.atan2(r.y-this.y,r.x-this.x)+2*Math.PI*e.getValue()),a=n*Math.cos(o),d=n*Math.sin(o);r.x=a+this.x,r.y=d+this.y,i.setPosition(r.x,r.y)}},{targets:i,x:a.x,y:a.y,ease:Phaser.Math.Easing.Cubic.InOut,duration:this.duration/4}],onComplete:()=>{this.tileGrid.addTileAtIndex(i,o.index.x,o.index.y),i.enableTileInteraction(),i.clearMask(),++r===s.length&&this.callback()}})}))}createHourglass(e,t,i){return[new Phaser.Geom.Point(e,t),new Phaser.Geom.Point(e+i/2,t+i/2),new Phaser.Geom.Point(e+i/2,t-i/2),new Phaser.Geom.Point(e,t),new Phaser.Geom.Point(e-i/2,t+i/2),new Phaser.Geom.Point(e-i/2,t-i/2)]}getPoint(e,t){let i=Math.floor(t*e.length),s=e[i],l=e[(i+1)%e.length],r=t*e.length%1;return this.interpolatePoint(s,l,r)}interpolatePoint(e,t,i){return new Phaser.Geom.Point(e.x+(t.x-e.x)*i,e.y+(t.y-e.y)*i)}};class E extends s.GameObjects.GameObject{constructor(e,t){super(e,"tileGridDirector"),this.scene=e,this.tileGrid=t}startIdle(){let e;Math.random(),e=new m(this.scene,this.tileGrid.getTileGrid()),e.start()}startShuffle(e,t,i,s=(()=>{})){let l;switch(Math.floor(4*Math.random())){case 0:l=new w(this.scene,this.tileGrid,e,t,300,i,s);break;case 1:l=new S(this.scene,this.tileGrid,e,t,350,i,s);break;case 2:l=new x(this.scene,this.tileGrid,e,t,200,i,s);break;case 3:l=new C(this.scene,this.tileGrid,e,t,200,i,s);break;default:l=new S(this.scene,this.tileGrid,e,t,200,i,s)}l.start()}endIdle(){}}const G=E,M=class{constructor(e,t){this.hintTweens=[],this.hintTiles=[],this.Scene=e,this.TileMatcher=t}startHintTiles(){let e=this.TileMatcher.getPotentialMatches();if(0===e.length)return;let t=e[Math.floor(Math.random()*e.length)],i=t.fromTile,s=t.toTile;this.hintTiles=[i,s,...t.matchTiles],this.hintTiles.forEach((e=>{let t=this.Scene.tweens.add({targets:e,displayWidth:1.2*e.getTileWidth(),displayHeight:1.2*e.getTileHeight(),yoyo:!0,repeat:1,duration:300,onStop:()=>{e.setDisplaySize(e.getTileWidth(),e.getTileHeight())}});this.hintTweens.push(t),e.on("pointerover",this.endHintTiles,this)}))}endHintTiles(){this.hintTweens.forEach((e=>{e.stop()})),this.hintTiles.forEach((e=>{e.off("pointerover",this.endHintTiles,this),e.setDisplaySize(e.getTileWidth(),e.getTileHeight())})),this.hintTweens=[]}},P=class{constructor(e,t,i,s){this.count=e,this.matchTiles=t,this.originTile=i,this.specialTileType=s,this.matchTilesExceptOrigin=this.matchTiles.filter((e=>e!==this.originTile))}},I=class{constructor(e,t,i){this.matchTiles=e,this.fromTile=t,this.toTile=i}},b=class{constructor(e){this.tileGrid=e}getMatches(){this.visitedTiles=new Set;let e=this.findVerticalMatches(),t=this.findHorizontalMatches(),i=this.findSquareMatches(),s=[];return this.extract5OrMoreContinuousMatch(e,s,t),this.extractCornerMatch(e,t,s),this.extract4ContinuousMatch(e,s,t),this.extractSquareMatch(i,s),this.extract3ContinuousMatch(e,s,t),s}extract5OrMoreContinuousMatch(e,t,i){this.sliceAllNonVisitedTileInMatch(e);for(let i=e.length-1;i>=0;i--){if(e[i].length<5)continue;let s=e[i],l=s[0],r=s.length;for(let e of s)e.getLastMoveTime()>l.getLastMoveTime()&&(l=e);t.push(new P(r,s,l,"COLOR_CLEAR")),this.addToVisitedTiles(s),e.splice(i,1),this.sliceAllNonVisitedTileInMatch(e),i=e.length}this.sliceAllNonVisitedTileInMatch(i);for(let e=i.length-1;e>=0;e--){if(i[e].length<5)continue;let s=i[e],l=s[0],r=s.length;for(let e of s)e.getLastMoveTime()>l.getLastMoveTime()&&(l=e);t.push(new P(r,s,l,"COLOR_CLEAR")),this.addToVisitedTiles(s),i.splice(e,1),this.sliceAllNonVisitedTileInMatch(i),e=i.length}}extractCornerMatch(e,t,i){this.sliceAllNonVisitedTileInMatch(e),this.sliceAllNonVisitedTileInMatch(t);for(let s=e.length-1;s>=0;s--)for(let l=t.length-1;l>=0&&!(s<0);l--){let r=e[s],h=t[l],n=this.intersection2TilesArray(r,h);if(0==n.length)continue;let o=this.union2TilesArray(r,h),a=n[0],d=o.length;i.push(new P(d,o,a,"BOMB")),this.addToVisitedTiles(o),t.splice(l,1),e.splice(s,1),this.sliceAllNonVisitedTileInMatch(e),this.sliceAllNonVisitedTileInMatch(t),s=e.length-1,l=t.length}}extract3ContinuousMatch(e,t,i){this.sliceAllNonVisitedTileInMatch(e);for(let i=e.length-1;i>=0;i--){if(3!=e[i].length)continue;let s=e[i],l=s[0],r=s.length;for(let e of s)e.getLastMoveTime()>l.getLastMoveTime()&&(l=e);t.push(new P(r,s,l,"NONE")),this.addToVisitedTiles(s),e.splice(i,1),this.sliceAllNonVisitedTileInMatch(e),i=e.length}this.sliceAllNonVisitedTileInMatch(i);for(let e=i.length-1;e>=0;e--){if(3!=i[e].length)continue;let s=i[e],l=s[0],r=s.length;for(let e of s)e.getLastMoveTime()>l.getLastMoveTime()&&(l=e);t.push(new P(r,s,l,"NONE")),this.addToVisitedTiles(s),i.splice(e,1),this.sliceAllNonVisitedTileInMatch(i),e=i.length}}extract4ContinuousMatch(e,t,i){this.sliceAllNonVisitedTileInMatch(e);for(let i=e.length-1;i>=0;i--){if(4!=e[i].length)continue;let s=e[i],l=s[0],r=s.length;for(let e of s)e.getLastMoveTime()>l.getLastMoveTime()&&(l=e);t.push(new P(r,s,l,"ROW_CLEAR")),this.addToVisitedTiles(s),e.splice(i,1),this.sliceAllNonVisitedTileInMatch(e),i=e.length}this.sliceAllNonVisitedTileInMatch(i);for(let e=i.length-1;e>=0;e--){if(4!=i[e].length)continue;let s=i[e],l=s[0],r=s.length;for(let e of s)e.getLastMoveTime()>l.getLastMoveTime()&&(l=e);t.push(new P(r,s,l,"COLUMN_CLEAR")),this.addToVisitedTiles(s),i.splice(e,1),this.sliceAllNonVisitedTileInMatch(i),e=i.length}}extractSquareMatch(e,t){this.sliceAllNonVisitedTileInMatch(e);for(let i=e.length-1;i>=0;i--){if(4!=e[i].length)continue;let s=e[i],l=s[0],r=s.length;for(let e of s)e.getLastMoveTime()>l.getLastMoveTime()&&(l=e);t.push(new P(r,s,l,"RANDOM_2")),this.addToVisitedTiles(s),e.splice(i,1),this.sliceAllNonVisitedTileInMatch(e),i=e.length}}addToVisitedTiles(e){for(let t of e)this.visitedTiles.add(t)}sliceAllNonVisitedTileInMatch(e){for(let t=e.length-1;t>=0;t--){let i=e[t];for(let s=i.length-1;s>=0;s--)if(this.visitedTiles.has(i[s])){let l=i.slice(0,s),r=i.slice(s+1,i.length);e.splice(t,1),l.length>=3&&(e.push(l),t=e.length),r.length>=3&&(e.push(r),t=e.length);break}}}union2TilesArray(e,t){return[...new Set([...e,...t])]}union3TilesArray(e,t,i){return[...new Set([...e,...t,...i])]}intersection2TilesArray(e,t){return e.filter((e=>t.includes(e)))}intersection3TilesArray(e,t,i){return e.filter((e=>t.includes(e)&&i.includes(e)))}findHorizontalMatches(){let e=[],t=[];for(let i=0;i<this.tileGrid.getRowCount();i++){let s=this.tileGrid.getRow(i);t=[];for(let l=0;l<s.length-2;l++){let s=this.tileGrid.getTileAtIndex(l,i),r=this.tileGrid.getTileAtIndex(l+1,i),h=this.tileGrid.getTileAtIndex(l+2,i);s&&r&&h&&this.checkColorSame(s,r)&&this.checkColorSame(r,h)&&(t.length>0&&-1==t.indexOf(s)&&(e.push(t),t=[]),-1==t.indexOf(s)&&t.push(s),-1==t.indexOf(r)&&t.push(r),-1==t.indexOf(h)&&t.push(h))}t.length>0&&e.push(t)}return e}findVerticalMatches(){let e=[];for(let t=0;t<this.tileGrid.getColumnCount();t++){let i=[];for(let s=0;s<this.tileGrid.getRowCount()-2;s++){let l=this.tileGrid.getTileAtIndex(t,s),r=this.tileGrid.getTileAtIndex(t,s+1),h=this.tileGrid.getTileAtIndex(t,s+2);l&&r&&h&&this.checkColorSame(l,r)&&this.checkColorSame(r,h)&&(i.length>0&&-1==i.indexOf(l)&&(e.push(i),i=[]),-1==i.indexOf(l)&&i.push(l),-1==i.indexOf(r)&&i.push(r),-1==i.indexOf(h)&&i.push(h))}i.length>0&&e.push(i)}return e}findSquareMatches(){let e=[];for(let t=0;t<this.tileGrid.getRowCount()-1;t++)for(let i=0;i<this.tileGrid.getColumnCount()-1;i++){let s=this.tileGrid.getTileAtIndex(i,t),l=this.tileGrid.getTileAtIndex(i+1,t),r=this.tileGrid.getTileAtIndex(i,t+1),h=this.tileGrid.getTileAtIndex(i+1,t+1);s&&l&&r&&h&&this.checkColorSame(s,l)&&this.checkColorSame(s,r)&&this.checkColorSame(s,h)&&e.push([s,l,r,h])}return e}findPotentialHorizontalMatches(){let e=[];for(let t=0;t<this.tileGrid.getRowCount();t++){let i=this.tileGrid.getRow(t);for(let s=-1;s<i.length-2;s++){let i=this.tileGrid.getTileAtIndex(s,t),l=this.tileGrid.getTileAtIndex(s+1,t),r=this.tileGrid.getTileAtIndex(s+2,t),h=this.tileGrid.getTileAtIndex(s+3,t);if(i&&l&&r&&(!h||!this.checkColorSame(h,r))&&!this.checkColorSame(i,l)&&this.checkColorSame(l,r)){let h=this.tileGrid.getTileAtIndex(s,t-1),n=this.tileGrid.getTileAtIndex(s,t+1),o=this.tileGrid.getTileAtIndex(s-1,t),a=i,d=[l,r];h&&this.checkColorSame(h,l)&&e.push(new I(d,a,h)),n&&this.checkColorSame(n,l)&&e.push(new I(d,a,n)),o&&this.checkColorSame(o,l)&&e.push(new I(d,a,o))}if(l&&r&&h&&(!i||!this.checkColorSame(i,l))&&this.checkColorSame(l,r)&&!this.checkColorSame(l,h)){let i=this.tileGrid.getTileAtIndex(s+3,t-1),n=this.tileGrid.getTileAtIndex(s+3,t+1),o=this.tileGrid.getTileAtIndex(s+4,t),a=h,d=[l,r];i&&this.checkColorSame(i,l)&&e.push(new I(d,a,i)),n&&this.checkColorSame(n,l)&&e.push(new I(d,a,n)),o&&this.checkColorSame(o,l)&&e.push(new I(d,a,o))}if(i&&l&&r&&this.checkColorSame(i,r)&&!this.checkColorSame(l,i)){let h=this.tileGrid.getTileAtIndex(s+1,t-1),n=this.tileGrid.getTileAtIndex(s+1,t+1),o=l,a=[i,r];h&&this.checkColorSame(h,i)&&e.push(new I(a,o,h)),n&&this.checkColorSame(n,i)&&e.push(new I(a,o,n))}if(l&&r&&h&&this.checkColorSame(l,h)&&!this.checkColorSame(l,r)){let i=this.tileGrid.getTileAtIndex(s+2,t-1),n=this.tileGrid.getTileAtIndex(s+2,t+1),o=r,a=[l,h];i&&this.checkColorSame(i,l)&&e.push(new I(a,o,i)),n&&this.checkColorSame(n,l)&&e.push(new I(a,o,n))}}}return e}getPotentialMatches(){return[...this.findPotentialHorizontalMatches(),...this.findPotentialVerticalMatches()]}findPotentialVerticalMatches(){let e=[];for(let t=0;t<this.tileGrid.getColumnCount();t++)for(let i=-1;i<this.tileGrid.getRowCount()-2;i++){let s=this.tileGrid.getTileAtIndex(t,i),l=this.tileGrid.getTileAtIndex(t,i+1),r=this.tileGrid.getTileAtIndex(t,i+2),h=this.tileGrid.getTileAtIndex(t,i+3);if(s&&l&&r&&(!h||!this.checkColorSame(h,r))&&!this.checkColorSame(s,l)&&this.checkColorSame(l,r)){let h=this.tileGrid.getTileAtIndex(t-1,i),n=this.tileGrid.getTileAtIndex(t+1,i),o=this.tileGrid.getTileAtIndex(t,i-1),a=s,d=[l,r];h&&this.checkColorSame(h,l)&&e.push(new I(d,a,h)),n&&this.checkColorSame(n,l)&&e.push(new I(d,a,n)),o&&this.checkColorSame(o,l)&&e.push(new I(d,a,o))}if(l&&r&&h&&(!s||!this.checkColorSame(s,l))&&this.checkColorSame(l,r)&&!this.checkColorSame(l,h)){let s=this.tileGrid.getTileAtIndex(t-1,i+3),n=this.tileGrid.getTileAtIndex(t+1,i+3),o=this.tileGrid.getTileAtIndex(t,i+4),a=h,d=[l,r];o&&this.checkColorSame(o,l)&&e.push(new I(d,a,o)),s&&this.checkColorSame(s,l)&&e.push(new I(d,a,s)),n&&this.checkColorSame(n,l)&&e.push(new I(d,a,n))}if(s&&l&&r&&this.checkColorSame(s,r)&&!this.checkColorSame(l,s)){let h=this.tileGrid.getTileAtIndex(t-1,i+1),n=this.tileGrid.getTileAtIndex(t+1,i+1),o=l,a=[s,r];h&&this.checkColorSame(h,s)&&e.push(new I(a,o,h)),n&&this.checkColorSame(n,s)&&e.push(new I(a,o,n))}if(l&&r&&h&&this.checkColorSame(l,h)&&!this.checkColorSame(r,l)){let s=this.tileGrid.getTileAtIndex(t-1,i+2),n=this.tileGrid.getTileAtIndex(t+1,i+2),o=r,a=[l,h];s&&this.checkColorSame(s,l)&&e.push(new I(a,o,s)),n&&this.checkColorSame(n,l)&&e.push(new I(a,o,n))}}return e}checkColorSame(e,t){return!(!e||!t||""==e.getColor()||""==t.getColor())&&e.getColor()===t.getColor()}},A=class{constructor(e,t){this.scene=e,this.firstSelectedTile=null,this.secondSelectedTile=null,this.canMove=!0,this.isSwapped=!1,this.tileGrid=t}swapTiles(){if(this.firstSelectedTile&&this.secondSelectedTile){this.isSwapped=!0,this.tileGrid.swapTiles(this.firstSelectedTile,this.secondSelectedTile);const e=this.firstSelectedTile;this.firstSelectedTile=this.secondSelectedTile,this.secondSelectedTile=e}}unswapTiles(){if(this.firstSelectedTile&&this.secondSelectedTile){this.isSwapped=!1,this.tileGrid.swapTiles(this.firstSelectedTile,this.secondSelectedTile);const e=this.firstSelectedTile;this.firstSelectedTile=this.secondSelectedTile,this.secondSelectedTile=e}}selectTile(e){if(!this.canMove)return;if(!this.firstSelectedTile)return void(this.firstSelectedTile=e);if(this.firstSelectedTile===e)return void this.resetSelectedTile();this.secondSelectedTile=e;let t=0,i=0;if(this.firstSelectedTile&&this.secondSelectedTile){let e=this.tileGrid.getMahattanIndexDistance(this.firstSelectedTile,this.secondSelectedTile);t=e.x,i=e.y}1===t&&0===i||0===t&&1===i?(this.canMove=!1,this.swapTiles()):(this.firstSelectedTile=e,this.secondSelectedTile=null)}resetSelectedTile(){this.firstSelectedTile=null,this.secondSelectedTile=null,this.isSwapped=!1}setCanMove(e){this.canMove=e}checkIsSwapped(){return this.isSwapped}checkFirstTileSelected(){return null!==this.firstSelectedTile}getCanMove(){return this.canMove}};class v extends Phaser.Events.EventEmitter{constructor(e,t){super(),this.currentScore=0,this.targetScore=0,this.accumaletedScore=0,this.diffcultyScale=1,this.isEnable=!0,this.targetScore=e*t,this.accumaletedScore=e,this.diffcultyScale=t}setTargetScore(e){this.targetScore=e}setCurrentScore(e){this.currentScore=e,this.emit(v.SCORE_CHANGED_EVENT,this.currentScore,0,this.targetScore)}getCurrentScore(){return this.currentScore}getTargetScore(){return this.targetScore}setEnable(e){this.isEnable=e}addScore(e){this.isEnable&&(this.currentScore+=e,this.emit(v.SCORE_CHANGED_EVENT,this.currentScore,e,this.targetScore),this.currentScore>=this.targetScore&&(this.emit(v.TARGET_SCORE_REACHED_EVENT),this.currentScore=0,this.accumaletedScore*=this.diffcultyScale,this.targetScore+=this.accumaletedScore))}}v.SCORE_CHANGED_EVENT="scoreChanged",v.TARGET_SCORE_REACHED_EVENT="targetScoreReached";const k=v,O=class{constructor(e){this.isComplete=!1,this.tween=e,this.tween.on("complete",(()=>{this.isComplete=!0})),this.tween.pause(),this.isComplete=!1}update(){}start(){this.tween.play()}stop(){this.tween.stop()}getCompleted(){return this.isComplete}},N=class{constructor(e,t,i,s,l){this.type="NONE",this.scene=e,this.tile=t,this.color=i,this.texture=s,this.type=l}onTileAppear(e=[]){let t=this.scene.data.get("simulationController");const i=this.tile.scaleX,s=this.tile.scaleY;if(this.tile.setDepth(1),0==e.length)return void this.scene.add.tween({targets:this.tile,scaleX:{from:0,to:i},scaleY:{from:0,to:s},duration:500,ease:"Back.out"});let l=e.map((e=>{const t=e;return"NONE"!=t.type?null:t.tile}));const r=this.tile.getWorldPosition();this.tile.setScale(0,0),l.forEach((e=>{if(null==e)return;let i=e.getWorldPosition(),s=this.scene.add.image(i.tx,i.ty,e.texture);s.setDepth(0),s.setScale(e.scaleX,e.scaleY);let l=this.scene.add.tween({targets:s,x:r.tx,y:r.ty,scale:{from:s.scale,to:.6*s.scale},alpha:{from:1,to:.4},duration:500,ease:Phaser.Math.Easing.Cubic.In,onComplete:()=>{s.destroy()}});t.addSimulation(new O(l),!0)}));let h=this.scene.add.tween({delay:350,targets:this.tile,scaleX:{from:0,to:i},scaleY:{from:0,to:s},duration:500,ease:"Back.out"});t.addSimulation(new O(h),!0)}},D=class{constructor(e){this.isComplete=!1,this.tween=e,this.tween.on("complete",(()=>{this.isComplete=!0})),this.tween.pause(),this.isComplete=!1}update(){}start(){this.tween.play()}stop(){this.tween.stop()}getCompleted(){return this.isComplete}},R=class extends N{constructor(e,t,i,s){super(e,t,i,s,"RANDOM_2")}onTilePop(){let e=this.tile.getTileGrid();this.tileGrid=e;let t=e.getFlattenTileGrid(),i=t[Math.floor(Math.random()*t.length)],s=t[Math.floor(Math.random()*t.length)];if(!(t.length<2)){for(;i===this.tile||s===this.tile||i===s;)i=t[Math.floor(Math.random()*t.length)],s=t[Math.floor(Math.random()*t.length)];this.tileToDestroy1=i,this.tileToDestroy2=s,e.popTiles([i,s])}}onTileDestroy(){var e,t;let i=this.scene.data.get("simulationController"),s=this.tile.getWorldPosition();this.tileGrid=this.tile.getTileGrid();let l=this.scene.add.particles(s.tx,s.ty,this.texture,{radial:!0,angle:{min:0,max:360},speed:{min:500,max:1e3},quantity:15,lifespan:500,alpha:{start:1,end:0},scale:{min:.5,max:1},rotate:{min:0,max:360}});for(l.setScale(.15),l.explode(25),this.scene.time.delayedCall(2e3,(()=>{l.destroy()})),null===this.tileGrid.getTileIndexInPopedGrid(this.tileToDestroy1)&&(this.tileToDestroy1=null!==(e=this.tileGrid.getRandomTileInPopedGrid())&&void 0!==e?e:this.tileToDestroy1),null===this.tileGrid.getTileIndexInPopedGrid(this.tileToDestroy2)&&(this.tileToDestroy2=null!==(t=this.tileGrid.getRandomTileInPopedGrid())&&void 0!==t?t:this.tileToDestroy2);this.tileToDestroy1===this.tileToDestroy2;){let e=this.tileGrid.getRandomTileInPopedGrid();if(null===e)break;this.tileToDestroy2=e}let r=this.createExplosionAnimation(this.tileToDestroy1),h=this.createExplosionAnimation(this.tileToDestroy2);i.addSimulation(new D(r),!0),i.addSimulation(new D(h),!0),this.scene.data.get("scoreController").addScore(1)}onTileSwapPop(e){console.log("BearTileEffect onTileSwapPop")}createExplosionAnimation(e){let t=this.tile.getWorldPosition(),i=e.getWorldPosition(),s=this.scene.add.image(t.tx,t.ty,this.texture);s.setFlipX(Math.random()>.5);let l=this.scene.add.image(i.tx,i.ty,"bomb-selection-01");return l.setVisible(!1),l.setPosition(i.tx,i.ty),this.scene.tweens.chain({tweens:[{targets:s,scale:{from:.25,to:1},x:{from:t.tx,to:(i.tx+t.tx)/2},y:{from:t.ty,to:(i.ty+t.ty)/2},duration:300,ease:"Quart.easeOut"},{targets:s,scale:{from:1,to:.25},x:{from:(i.tx+t.tx)/2,to:i.tx},y:{from:(i.ty+t.ty)/2,to:i.ty},duration:300,ease:"Sine.easeIn",onComplete:()=>{s.destroy()}},{targets:l,scale:{from:.25,to:1},alpha:{from:.5,to:2},duration:300,ease:"Linear",onStart:()=>{l.setVisible(!0)},onComplete:()=>{l.setVisible(!1),l.destroy(),this.tileGrid.destroyPopTile(e,this)}}]})}},V=class extends N{constructor(e,t,i,s){super(e,t,i,s,"BOMB"),this.tilesToDestroy=[]}onTilePop(){let e=this.tile.getTileGrid();this.tileGrid=e;let t=e.getTileIndex(this.tile,!0);this.tileIndex=t;for(let i=-1;i<=1;i++)for(let s=-1;s<=1;s++){let l=e.getTileAtIndex(t.x+i,t.y+s);null!=l&&l!=this.tile&&this.tilesToDestroy.push(l)}e.popTiles(this.tilesToDestroy)}onTileDestroy(){let e=this.scene.data.get("simulationController"),t=this.tile.getWorldPosition(),i=this.scene.add.sprite(t.tx,t.ty,"bomb-05");i.play("bomb-animation"),this.tileGrid=this.tile.getTileGrid();let s=this.scene.tweens.chain({tweens:[{targets:i,scale:{from:0,to:1.5},alpha:{from:0,to:.8},duration:500,ease:"Cubic.easeOut"},{targets:i,alpha:{from:.8,to:0},duration:300,ease:"Cubic.easeIn"}],onComplete:()=>{i.destroy()}});this.tilesToDestroy.forEach((e=>{this.tileGrid.destroyPopTile(e,this)})),e.addSimulation(new D(s),!0),this.scene.data.get("scoreController").addScore(1)}onTileSwapPop(e){console.log("BombTileEffect onTileSwapPop")}},W=class{constructor(e,t,i,s=0){this.isComplete=!1,this.timerEvent=e.time.addEvent({delay:t,callback:i,callbackScope:this,repeat:s,loop:!1,paused:!0})}update(){}start(){this.timerEvent.paused=!1}stop(){this.timerEvent.paused=!0,this.timerEvent.remove(!1),this.isComplete=!0}getCompleted(){return this.isComplete||0==this.timerEvent.getOverallRemainingSeconds()}},_=class extends N{constructor(e,t,i,s){super(e,t,i,s,"COLOR_CLEAR"),this.tileToDestroy=[]}onTilePop(){let e=h[Math.floor(Math.random()*h.length)];this.popTileColor(e)}onTileDestroy(){let e=this.scene.data.get("simulationController"),t=this.tile.getWorldPosition();this.scene.data.get("scoreController").addScore(1);let i=this.scene.add.image(t.tx,t.ty,this.texture);i.setDisplaySize(this.tile.displayWidth,this.tile.displayHeight);let s=Math.max(300,Math.min(100*this.tileToDestroy.length,2e3)),l=this.scene.tweens.add({targets:i,rotation:"+=6.28319",duration:200,repeat:-1});const r=this.scene.add.particles(t.tx,t.ty,"lightning-3-sheet",{anim:"lightning-bolt",rotate:{min:0,max:360},scale:{start:.25,end:.5},lifespan:500,duration:s,frequency:100});r.start(),e.addSimulation(new W(this.scene,s,(()=>{l.stop(),i.destroy(),r.destroy(),this.scene.add.particles(t.tx,t.ty,this.texture,{radial:!0,angle:{min:0,max:360},speed:{min:100,max:200},quantity:15,lifespan:500,alpha:{start:1,end:0},scale:{min:.125,max:.25},rotate:{min:0,max:360}}).explode(25)})),!0);let h=this.tile.getWorldPosition();this.tileToDestroy.forEach(((t,i)=>{let l=this.scene.add.sprite(h.tx,h.ty,"lightning-strike");l.play("lightning-strike-start"),l.once("animationcomplete",(()=>{l.play("lightning-strike-loop")}));let r=Phaser.Math.Angle.Between(t.x,t.y,this.tile.x,this.tile.y);l.setRotation(r-Math.PI/2),l.setOrigin(.5,1);const n=.5;let o=t.getWorldPosition();o.tx+=l.displayHeight*n/2*Math.cos(r),o.ty+=l.displayHeight*n/2*Math.sin(r);let a=this.scene.add.sprite(o.tx,o.ty,"lightning-1-sheet");a.setVisible(!1),a.setScale(.3),l.setScale(0);let d=this.scene.tweens.chain({tweens:[{delay:s/this.tileToDestroy.length*i,targets:l,x:o.tx,y:o.ty,scaleX:n,scaleY:n,duration:500}],onComplete:()=>{l.play("lightning-strike-end"),l.once("animationcomplete",(()=>{l.destroy()})),a.setVisible(!0),a.play("lightning-blast"),a.once("animationcomplete",(()=>{a.destroy()})),this.tileGrid.destroyPopTile(t,this)}});e.addSimulation(new D(d),!0)}))}onTileSwapPop(e){"COLOR_CLEAR"===e.type?(this.popTileColor(h),this.popTileColor("")):this.popTileColor(e.color)}popTileColor(e){if(Array.isArray(e))return void e.forEach((e=>{this.popTileColor(e)}));let t=this.tile.getTileGrid();this.tileGrid=t;let i=t.getFlattenTileGrid();if(0===i.length)return;let s=i.filter((e=>""===e.getColor())),l=i.filter((t=>t.getColor()===e));if(""!==e&&s.length!=i.length)for(;0==l.length;)e=h[Math.floor(Math.random()*h.length)],l=i.filter((t=>t.getColor()===e));this.tileToDestroy=[...this.tileToDestroy,...l],t.popTiles(l)}},H=class extends N{constructor(e,t,i,s){super(e,t,i,s,"ROW_CLEAR"),this.popTilesRight=[],this.popTilesLeft=[]}onTilePop(){let e=this.tile.getTileGrid(),t=e.getTileIndex(this.tile,!0);this.tileIndex=t;for(let i=t.x+1;i<e.getRowCount();i++){let s=e.getTileAtIndex(i,t.y);null!=s&&s!=this.tile&&this.popTilesLeft.push(s)}for(let i=t.x-1;i>=0;i--){let s=e.getTileAtIndex(i,t.y);null!=s&&s!=this.tile&&this.popTilesRight.push(s)}e.popTiles(this.popTilesRight),e.popTiles(this.popTilesLeft)}onTileDestroy(){let e=this.scene.data.get("simulationController"),t=this.tile.getWorldPosition(),i=this.tile.getTileGrid(),s=this.scene.add.image(t.tx,t.ty,"stripes_destroy");s.setOrigin(1,.5);let l=new Set;const r=e=>{const t=e.getValue(),s=e.targets;l.has(Math.floor(t))||i.destroyPopTile(s[Math.floor(t)],this)};let h=this.scene.tweens.chain({tweens:[{targets:s,x:{from:t.tx,to:t.tx+500},scaleY:{from:.8,to:1.2},scaleX:{from:1,to:4},duration:250,ease:"Cubic.in"},{targets:s,x:{from:t.tx+500,to:t.tx+1e3},duration:250,ease:"Cubic.out"}]}),n=this.scene.add.image(t.tx,t.ty,"stripes_destroy");n.setOrigin(0,.5);let o=this.scene.tweens.chain({tweens:[{targets:n,x:{from:t.tx,to:t.tx-500},scaleY:{from:.8,to:1.2},scaleX:{from:1,to:4},duration:250,ease:"Cubic.in"},{targets:n,x:{from:t.tx-500,to:t.tx-1e3},duration:250,ease:"Cubic.out"}]}),a=this.scene.add.tween({targets:this.popTilesRight,values:{from:0,to:this.popTilesRight.length-1},duration:400,ease:"Linear",onUpdate:r}),d=this.scene.add.tween({targets:this.popTilesLeft,values:{from:0,to:this.popTilesLeft.length-1},duration:400,ease:"Linear",onUpdate:r});e.addSimulation(new D(h),!0),e.addSimulation(new D(o),!0),e.addSimulation(new O(a),!0),e.addSimulation(new O(d),!0),this.scene.time.delayedCall(500,(()=>{s.destroy(),n.destroy()})),this.scene.data.get("scoreController").addScore(1)}onTileSwapPop(e){console.log("HorizontalStripeTileEffect onTileSwapPop")}},L=class extends N{constructor(e,t,i,s){super(e,t,i,s,"NONE")}onTilePop(){}onTileDestroy(e){this.scene.data.get("scoreController").addScore(1);let t=this.scene.data.get("simulationController"),i=this.tile.getWorldPosition(),s=this.scene.add.particles(i.tx,i.ty,this.texture,{radial:!0,angle:{min:0,max:360},speed:{min:500,max:1e3},quantity:15,lifespan:500,alpha:{start:1,end:0},scale:{min:.5,max:1},rotate:{min:0,max:360}});s.setScale(.15),s.explode(25),t.addSimulation(new W(this.scene,600,(()=>{s.destroy()})))}onTileSwapPop(e){}},z=class extends N{constructor(e,t,i,s){super(e,t,i,s,"COLUMN_CLEAR"),this.popTilesUp=[],this.popTilesDown=[]}onTilePop(){let e=this.tile.getTileGrid(),t=e.getTileIndex(this.tile,!0);this.tileIndex=t;for(let i=t.y+1;i<e.getRowCount();i++){let s=e.getTileAtIndex(t.x,i);null!=s&&s!=this.tile&&this.popTilesDown.push(s)}for(let i=t.y-1;i>=0;i--){let s=e.getTileAtIndex(t.x,i);null!=s&&s!=this.tile&&this.popTilesUp.push(s)}e.popTiles(this.popTilesUp),e.popTiles(this.popTilesDown)}onTileDestroy(){let e=this.scene.data.get("simulationController"),t=this.tile.getWorldPosition(),i=this.tile.getTileGrid(),s=this.scene.add.image(t.tx,t.ty,"stripes_destroy");s.setRotation(Math.PI/2),s.setOrigin(0,.5);let l=new Set;const r=e=>{const t=e.getValue(),s=e.targets;l.has(Math.floor(t))||i.destroyPopTile(s[Math.floor(t)],this)};let h=this.scene.tweens.chain({tweens:[{targets:s,y:{from:t.ty,to:t.ty+200},scaleY:{from:1,to:1.5},scaleX:{from:1,to:5},duration:350,ease:"Cubic.in"},{targets:s,y:{from:t.ty+200,to:t.ty+400},duration:350,ease:"Cubic.out"}]}),n=this.scene.add.image(t.tx,t.ty,"stripes_destroy");n.setRotation(-Math.PI/2),n.setOrigin(0,.5);let o=this.scene.tweens.chain({tweens:[{targets:n,y:{from:t.ty,to:t.ty-200},scaleY:{from:1,to:1.5},scaleX:{from:1,to:5},duration:350,ease:"Cubic.in"},{targets:n,y:{from:t.ty-200,to:t.ty-400},duration:350,ease:"Cubic.out"}]}),a=this.scene.add.tween({targets:this.popTilesUp,values:{from:0,to:this.popTilesUp.length-1},duration:400,ease:"Linear",onUpdate:r}),d=this.scene.add.tween({targets:this.popTilesDown,values:{from:0,to:this.popTilesDown.length-1},duration:400,ease:"Linear",onUpdate:r});e.addSimulation(new D(h),!0),e.addSimulation(new D(o),!0),e.addSimulation(new O(a),!0),e.addSimulation(new O(d),!0),this.scene.time.delayedCall(700,(()=>{s.destroy(),n.destroy()})),this.scene.data.get("scoreController").addScore(1)}onTileSwapPop(e){console.log("VerticalStripeTileEffect onTileSwapPop")}},F=class{constructor(e,t,i,s){this.scene=e,this.colors=t,this.textureWidth=i,this.textureHeight=s}createRandomTile(e,t){let i=this.colors[Phaser.Math.RND.between(0,this.colors.length-1)],s=n.normalCandyTextureKey[i],l=new d({scene:this.scene,x:e,y:t,texture:s});return l.setDisplaySize(this.textureWidth,this.textureHeight).setTileEffect(new L(this.scene,l,i,s)),l}createSpecialTile(e,t,i,s){let l=this.getSpecialTileTexture(t,e),r=new d({scene:this.scene,x:i,y:s,texture:l});r.setDisplaySize(this.textureWidth,this.textureHeight);let h=this.getSpecialTileEffect(t,e,r);return r.setTileEffect(h),r}getSpecialTileTexture(e,t){switch(e){case"BOMB":return n.bombCandyTextureKey[t];case"COLOR_CLEAR":return n.cholateCandyTextureKey;case"COLUMN_CLEAR":return n.verticalStripesCandyTextureKey[t];case"ROW_CLEAR":return n.horizontalStripesCandyTextureKey[t];case"RANDOM_2":return n.bearCandyTextureKey[t];default:return n.normalCandyTextureKey[t]}}getSpecialTileEffect(e,t,i){switch(e){case"BOMB":return new V(this.scene,i,t,n.bombCandyTextureKey[t]);case"COLOR_CLEAR":return new _(this.scene,i,"",n.cholateCandyTextureKey);case"COLUMN_CLEAR":return new z(this.scene,i,t,n.verticalStripesCandyTextureKey[t]);case"ROW_CLEAR":return new H(this.scene,i,t,n.horizontalStripesCandyTextureKey[t]);case"RANDOM_2":return new R(this.scene,i,t,n.bearCandyTextureKey[t]);default:return new L(this.scene,i,t,n.normalCandyTextureKey[t])}}};class B extends s.GameObjects.Container{constructor(e,t,i,s,l){super(e,t,i),this.progressBar=this.scene.add.nineslice(t,i,"progress-bar-02","",s,l),this.progressBar.setOrigin(0,.5),this.add(this.progressBar),this.progressBar.setDisplaySize(s,l),this.progressFill=this.scene.add.nineslice(t+10,i,"progress-bar-01","",.975*s,l,s/4,s/4),this.progressFill.setOrigin(0,.5),this.add(this.progressFill),this.progressFill.setScale(0,1),this.progressBorder=this.scene.add.nineslice(t,i,"progress-bar-03","",s,l),this.progressBorder.setOrigin(0,.5),this.add(this.progressBorder),this.progressBorder.setDisplaySize(s,l),this.scene.add.existing(this)}setProgress(e){e<0&&(e=0),e>1&&(e=1),this.moveTween&&this.moveTween.stop(),this.moveTween=this.scene.add.tween({targets:this.progressFill,duration:500,scaleX:e,ease:"Cubic.easeOut"})}}const U=B;class K extends Phaser.GameObjects.GameObject{constructor(e){super(e,"SimulationController"),this.simulations=[],this.hasStarted=!1,this.hasEnded=!1,this.hasCompleted=!1,this.nextSimulations=[],this.hasInvokeNextStart=!1,this.completeCallback=this.emptyFunction,this.endCallback=this.emptyFunction,this.nextCompleteCallback=this.emptyFunction,this.nextEndCallback=this.emptyFunction,this.simulations=[],this.scene.events.on("update",this.update,this)}update(...e){this.hasInvokeNextStart&&this.hasEnded&&(this.extractNextSimulations(),this.startSimulation(this.completeCallback,this.endCallback)),this.getCompleted()&&this.hasStarted&&!this.hasCompleted&&!this.hasEnded&&(this.hasCompleted=!0,this.simulations=[],this.completeCallback(),this.emit(K.COMPLETE_EVENT),this.hasEnded=!1),this.getCompleted()&&this.hasStarted&&this.hasCompleted&&!this.hasEnded&&(this.hasEnded=!0,this.simulations=[],this.endCallback(),this.emit(K.END_EVENT))}addSimulation(e,t=!1){return this.hasCompleted?this.hasCompleted&&!this.hasEnded&&t?(this.simulations.push(e),void e.start()):void this.nextSimulations.push(e):(this.simulations.push(e),void e.start())}startSimulation(e,t){if(this.hasStarted&&!this.hasEnded)return this.hasInvokeNextStart=!0,this.nextCompleteCallback=e||this.emptyFunction,void(this.nextEndCallback=t||this.emptyFunction);this.hasStarted=!0,this.hasInvokeNextStart=!1,this.hasCompleted=!1,this.hasEnded=!1,0==this.simulations.length&&0!=this.nextSimulations.length&&this.extractNextSimulations(),this.completeCallback=e||this.emptyFunction,this.endCallback=t||this.emptyFunction,this.simulations.forEach((e=>{e.start()})),this.emit(K.START_EVENT)}extractNextSimulations(){this.simulations=this.nextSimulations,this.nextSimulations=[],this.hasInvokeNextStart=!1,this.completeCallback=this.nextCompleteCallback,this.endCallback=this.nextEndCallback,this.nextCompleteCallback=this.emptyFunction,this.nextEndCallback=this.emptyFunction}emptyFunction(){}removeSimulation(e){this.simulations=this.simulations.filter((t=>t!==e))}stopSimulation(){this.simulations.forEach((e=>{e.stop()})),this.hasStarted=!1}getCompleted(){let e=!0;return this.simulations.forEach((t=>{t.getCompleted()||(e=!1)})),e}getSimulations(){return this.simulations}}K.COMPLETE_EVENT="complete",K.START_EVENT="start",K.END_EVENT="end";const X=K;class Y extends Phaser.GameObjects.Graphics{constructor(e,t,i,s=1e3,l=new Phaser.Math.Vector2(0,-1),r=1e3,h=10,n=10){super(e),this.duration=1e3,this.deltaTime=0,this.direction=new Phaser.Math.Vector2(1,0),this.speed=100,this.spreadAngleDegree=10,this.frequency=10,this.scene=e,this.x=t,this.y=i,this.duration=s,this.direction=l.normalize(),this.speed=r,this.spreadAngleDegree=h,this.frequency=n,this.scene.add.existing(this),this.scene.events.on("update",this.update,this),this.createConffeti()}update(e,t){this.deltaTime=t/1e3}createConffeti(){this.scene.add.particles(this.x,this.y,"sunset-raster",{speed:{onEmit:e=>Phaser.Math.Between(this.speed,1.3*this.speed)*this.direction.y},angle:{onEmit:e=>Phaser.Math.RadToDeg(Phaser.Math.Angle.Between(0,0,this.direction.x,this.direction.y))+Phaser.Math.Between(-this.spreadAngleDegree,this.spreadAngleDegree)},lifespan:2*this.duration,frequency:this.frequency,duration:this.duration/2,frame:[0,4,8,12,16],x:{onEmit:e=>Phaser.Math.Between(0,0),onUpdate:(e,t,i)=>(e.velocityY<0?e.velocityY+=500*this.deltaTime:(e.velocityY+=150*this.deltaTime,e.velocityX*=.995),e.x)},scaleX:{onEmit:e=>-1,onUpdate:e=>e.scaleX>1?-1:e.scaleX+.05},rotate:{onEmit:e=>0,onUpdate:e=>e.angle+1}}),this.scene.time.delayedCall(this.duration,(()=>{this.scene.events.off("update",this.update,this),this.destroy()}))}}const q=Y;class j extends Phaser.Scene{constructor(){super({key:"GameScene"}),this.isReachTargetedScore=!1}create(){this.initializeVariables(),this.initializeBindEvents(),this.setBackground(),this.initializeGrid(),this.startCheckMatch()}initializeVariables(){this.simulationController=new X(this),this.scoreController=new k(50,1),this.data.set("simulationController",this.simulationController),this.data.set("scoreController",this.scoreController),this.tileFactory=new F(this,h,n.tileWidth,n.tileHeight),this.tileGrid=new u(this,400,70,n.gridWidth,n.gridHeight,n.tileWidth,n.tileHeight,this.tileFactory,["item-spot-01","item-spot-02"]),this.tileMatcher=new b(this.tileGrid),this.tileSwapper=new A(this,this.tileGrid),this.tileHinter=new M(this,this.tileMatcher),this.gameInputHandler=new p(this,this.tileSwapper),this.tileGridDirector=new G(this,this.tileGrid),this.progressUi=new U(this,200,360,600,40),this.progressUi.setDepth(100);let e=this.add.graphics();e.fillRect(400,70,n.gridWidth*n.tileWidth,(n.gridHeight+1)*n.tileHeight),e.fillStyle(16777215),this.tileGrid.setMask(e.createGeometryMask())}setBackground(){this.cameras.main.setBackgroundColor(7908062);const e=this.add.image(0,0,"background-01");e.setOrigin(0,0),e.setDisplaySize(this.game.canvas.width+50,this.game.canvas.height+50),e.setDepth(-100)}initializeGrid(){this.tileGrid.on(u.TILE_ADD_EVENT,this.tweenDropdownTile,this),this.tileGrid.on(u.TILE_GRAVITATE_EVENT,this.tweenDropdownTile,this),this.tileGrid.on(u.TILE_SWAP_EVENT,this.tweenSwapTiles,this),this.tileGrid.initializeTiles()}initializeBindEvents(){let e=0;this.gameInputHandler.on(p.NO_INPUT_PERIOD_EVENT,(()=>{e++,e%3==0?this.tileGridDirector.startIdle():this.tileHinter.startHintTiles()})),this.simulationController.on(X.END_EVENT,(()=>{this.gameInputHandler.startTimer()})),this.simulationController.on(X.START_EVENT,(()=>{this.gameInputHandler.stopTimer()})),this.scoreController.on(k.SCORE_CHANGED_EVENT,((e,t,i)=>{this.progressUi.setProgress(e/i)})),this.scoreController.on(k.TARGET_SCORE_REACHED_EVENT,(()=>{this.isReachTargetedScore=!0,this.scoreController.setEnable(!1)}))}startCheckMatch(){this.tileSwapper.setCanMove(!1);let e=!1;const t=()=>{this.tileGridDirector.startShuffle(690,370,5e3,(()=>{this.checkMatches()?this.startCheckMatch():i()})),new q(this,0,800,4e3,new Phaser.Math.Vector2(1,-2),900,30,10),new q(this,1400,800,4e3,new Phaser.Math.Vector2(-1,-2),900,30,10)},i=()=>{0==this.tileMatcher.getPotentialMatches().length?t():this.tileSwapper.setCanMove(!0)};this.simulationController.startSimulation((()=>{e=this.checkMatches()}),(()=>{e?this.startCheckMatch():this.isReachTargetedScore?(this.isReachTargetedScore=!1,this.scoreController.setEnable(!0),this.scoreController.setCurrentScore(0),t()):i()}))}checkMatches(e,t){let i=this.tileMatcher.getMatches();if(i.length>0){let s=new Map,l=new Map;return i.forEach((i=>{"NONE"!==i.specialTileType&&(e&&i.matchTiles.includes(e)&&(i.originTile=e,i.matchTilesExceptOrigin=i.matchTiles.filter((e=>e!==i.originTile))),t&&i.matchTiles.includes(t)&&(i.originTile=t,i.matchTilesExceptOrigin=i.matchTiles.filter((e=>e!==i.originTile))),s.set(i.originTile,{x:i.originTile.x,y:i.originTile.y})),this.tileGrid.popTiles(i.matchTiles)})),i.forEach((e=>{if("NONE"!==e.specialTileType){let t=this.tileFactory.createSpecialTile(e.originTile.getColor(),e.specialTileType,e.originTile.x,e.originTile.y);this.tileGrid.addTileAtLocalPosition(t,s.get(e.originTile).x,s.get(e.originTile).y);let i=e.matchTilesExceptOrigin.map((e=>e.getTileEffect()));t.setAppear(i),l.set(e.originTile,t)}})),this.tileGrid.gravitateTile(),this.tileGrid.fillEmptyGridWithTile(),i.forEach((e=>{e.matchTiles.forEach((t=>{"NONE"!==e.specialTileType?this.tileGrid.destroyPopTile(t,l.get(e.originTile).getTileEffect(),!0):this.tileGrid.destroyPopTile(t)}))})),!0}return!1}checkSwap(e,t){let i=e.getTileEffect().type,s=t.getTileEffect().type;if("COLOR_CLEAR"!==i&&"COLOR_CLEAR"!==s)return!1;if("COLOR_CLEAR"!==i){const i=e;e=t,t=i}return this.tileGrid.swapPopTiles(e,t),this.tileGrid.gravitateTile(),this.tileGrid.fillEmptyGridWithTile(),this.tileGrid.destroyPopTile(e),this.tileGrid.destroyPopTile(t),!0}tweenDropdownTile(e,t,i,s,l){const r=new D(this.tweens.chain({tweens:[{targets:e,delay:1500/(Math.pow(l,2)+3),y:(l+.5)*n.tileHeight,ease:"Cubic.In",duration:Math.max(150*(l-i),300),repeat:0,yoyo:!1}],onActive:()=>{e.disableTileInteraction()},onComplete:()=>{var t;e.setLastMoveTime(this.time.now),null===(t=e.getMapTween("displaySize"))||void 0===t||t.stop();const s=e.displayHeight,r=e.displayWidth;let h=this.tweens.add({targets:e,y:e.y-4*(l-i),displayHeight:.8*s,displayWidth:1.2*r,ease:"Quad.Out",duration:100,yoyo:!0,repeat:0,onComplete:()=>{e.removeMapTween("displaySize"),e.enableTileInteraction()},onStop:()=>{e.setDisplaySize(r,s),e.removeMapTween("displaySize")}});e.addMapTween("displaySize",h)}}));this.simulationController.addSimulation(r)}tweenSwapTiles(e,t){const i=new O(this.add.tween({targets:e,x:t.x,y:t.y,ease:"Linear",duration:250,repeat:0,yoyo:!1})),s=new O(this.add.tween({targets:t,x:e.x,y:e.y,ease:"Linear",duration:250,repeat:0,yoyo:!1}));this.simulationController.addSimulation(i),this.simulationController.addSimulation(s);let l=!1,r=!1;this.simulationController.startSimulation((()=>{r=this.checkSwap(e,t),r||(l=this.checkMatches(e,t))}),(()=>{r||l?(this.tileSwapper.resetSelectedTile(),this.startCheckMatch()):this.tileSwapper.checkIsSwapped()?this.tileSwapper.unswapTiles():(this.tileSwapper.resetSelectedTile(),this.tileSwapper.setCanMove(!0))}))}}const Q=j,$={title:"Candy crush",url:"https://github.com/digitsensitive/phaser3-typescript",version:"0.0.1",type:Phaser.AUTO,autoCenter:Phaser.Scale.CENTER_BOTH,scale:{mode:Phaser.Scale.FIT,width:1400,height:787.5},parent:"game",scene:[r,Q],backgroundColor:"#de3412",render:{pixelArt:!1,antialias:!0}};class J extends Phaser.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new J($)}))}},i={};function s(e){var l=i[e];if(void 0!==l)return l.exports;var r=i[e]={exports:{}};return t[e].call(r.exports,r,r.exports,s),r.exports}s.m=t,e=[],s.O=(t,i,l,r)=>{if(!i){var h=1/0;for(d=0;d<e.length;d++){for(var[i,l,r]=e[d],n=!0,o=0;o<i.length;o++)(!1&r||h>=r)&&Object.keys(s.O).every((e=>s.O[e](i[o])))?i.splice(o--,1):(n=!1,r<h&&(h=r));if(n){e.splice(d--,1);var a=l();void 0!==a&&(t=a)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[i,l,r]},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={792:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var l,r,[h,n,o]=i,a=0;if(h.some((t=>0!==e[t]))){for(l in n)s.o(n,l)&&(s.m[l]=n[l]);if(o)var d=o(s)}for(t&&t(i);a<h.length;a++)r=h[a],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return s.O(d)},i=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var l=s.O(void 0,[96],(()=>s(271)));l=s.O(l)})();